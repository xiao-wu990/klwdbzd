<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>炸弹躲避大冒险</title>
    <style>
        :root {
            --primary-color: #4a6bff;
            --secondary-color: #ff6b6b;
            --accent-color: #feca57;
            --dark-color: #2c3e50;
            --light-color: #ecf0f1;
            --success-color: #1dd1a1;
            --danger-color: #ff6b6b;
            --warning-color: #feca57;
            --info-color: #54a0ff;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: var(--dark-color);
            overflow-x: hidden;
        }

        /* 登录注册界面 */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .auth-box {
            background-color: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            padding: 30px;
            text-align: center;
            transform-style: preserve-3d;
            transition: all 0.5s ease;
        }

        .auth-box h1 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 28px;
        }

        .auth-tabs {
            display: flex;
            margin-bottom: 20px;
            border-radius: 10px;
            overflow: hidden;
            background-color: #f1f3f6;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .auth-tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e3e7;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
            outline: none;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .btn:hover {
            background-color: #3a5bef;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(74, 107, 255, 0.3);
        }

        .remember-me {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .remember-me input {
            margin-right: 10px;
        }

        .auth-footer {
            margin-top: 20px;
            font-size: 14px;
        }

        .auth-footer a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: bold;
        }

        /* 主界面 */
        .main-container {
            display: none;
            min-height: 100vh;
            background-color: #f5f7fa;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            z-index: 100;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
        }

        .logo img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid white;
            transition: all 0.3s ease;
        }

        .user-avatar:hover {
            transform: scale(1.1);
            box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .dropdown-menu {
            position: absolute;
            right: 0;
            top: 50px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            width: 200px;
            padding: 10px 0;
            display: none;
            z-index: 1000;
        }

        .dropdown-menu.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .dropdown-item {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
        }

        .dropdown-item:hover {
            background-color: #f8f9fa;
        }

        .dropdown-item i {
            margin-right: 10px;
            color: var(--primary-color);
        }

        .dropdown-divider {
            height: 1px;
            background-color: #e9ecef;
            margin: 5px 0;
        }

        .admin-badge {
            background-color: var(--danger-color);
            color: white;
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
        }

        .vip-badge {
            background-color: var(--warning-color);
            color: var(--dark-color);
            font-size: 12px;
            padding: 2px 8px;
            border-radius: 10px;
            margin-left: 5px;
        }

        /* 游戏主页 */
        .home-content {
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .welcome-section {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .welcome-section::before {
            content: "";
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(74, 107, 255, 0.1) 0%, rgba(74, 107, 255, 0) 70%);
            animation: rotate 20s linear infinite;
            z-index: 0;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .welcome-content {
            position: relative;
            z-index: 1;
        }

        .welcome-section h2 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 28px;
        }

        .welcome-section p {
            color: #6c757d;
            margin-bottom: 20px;
            font-size: 16px;
        }

        .stats-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-size: 20px;
            color: white;
        }

        .stat-icon.coins {
            background-color: var(--accent-color);
        }

        .stat-icon.keys {
            background-color: var(--success-color);
        }

        .stat-icon.score {
            background-color: var(--info-color);
        }

        .stat-icon.lives {
            background-color: var(--danger-color);
        }

        .stat-info h3 {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .stat-info p {
            font-size: 24px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .action-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .action-btn {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .action-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .action-btn i {
            font-size: 30px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .action-btn.play i {
            color: var(--success-color);
        }

        .action-btn.shop i {
            color: var(--accent-color);
        }

        .action-btn.leaderboard i {
            color: var(--info-color);
        }

        .action-btn.settings i {
            color: #6c757d;
        }

        .action-btn h3 {
            font-size: 18px;
            margin-bottom: 5px;
            color: var(--dark-color);
        }

        .action-btn p {
            font-size: 14px;
            color: #6c757d;
        }

        /* 游戏界面 */
        .game-container {
            display: none;
            position: relative;
            width: 100%;
            height: calc(100vh - 70px);
            overflow: hidden;
            background-color: #f0f2f5;
        }

        .game-canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #e0e5ec;
        }

        .game-ui {
            position: absolute;
            top: 20px;
            left: 20px;
            right: 20px;
            display: flex;
            justify-content: space-between;
            z-index: 10;
        }

        .game-stat {
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 8px 15px;
            display: flex;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .game-stat i {
            margin-right: 8px;
            font-size: 18px;
        }

        .game-stat.coins i {
            color: var(--accent-color);
        }

        .game-stat.keys i {
            color: var(--success-color);
        }

        .game-stat.lives i {
            color: var(--danger-color);
        }

        .game-stat.score i {
            color: var(--info-color);
        }

        .mobile-controls {
            display: none;
            position: absolute;
            bottom: 30px;
            left: 0;
            right: 0;
            padding: 0 20px;
            z-index: 10;
        }

        .mobile-controls-grid {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            grid-template-rows: auto auto;
            gap: 10px;
            max-width: 300px;
            margin: 0 auto;
        }

        .mobile-btn {
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
            cursor: pointer;
            transition: all 0.2s ease;
            user-select: none;
        }

        .mobile-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .mobile-btn.up {
            grid-column: 2;
            grid-row: 1;
        }

        .mobile-btn.left {
            grid-column: 1;
            grid-row: 2;
        }

        .mobile-btn.down {
            grid-column: 2;
            grid-row: 2;
        }

        .mobile-btn.right {
            grid-column: 3;
            grid-row: 2;
        }

        .mobile-btn.pause {
            position: absolute;
            right: 20px;
            bottom: 20px;
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.9);
        }

        /* 游戏结束界面 */
        .game-over {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 20;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            text-align: center;
        }

        .game-over-content {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-over h2 {
            color: var(--danger-color);
            font-size: 32px;
            margin-bottom: 15px;
        }

        .game-over p {
            color: #6c757d;
            margin-bottom: 20px;
            font-size: 18px;
        }

        .game-over-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }

        .game-over-stat {
            background-color: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }

        .game-over-stat h3 {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 5px;
        }

        .game-over-stat p {
            font-size: 24px;
            font-weight: bold;
            color: var(--dark-color);
            margin-bottom: 0;
        }

        .game-over-buttons {
            display: flex;
            gap: 15px;
        }

        .game-over-btn {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .game-over-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .game-over-btn.secondary {
            background-color: #e9ecef;
            color: var(--dark-color);
        }

        .game-over-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        .new-highscore {
            background-color: var(--accent-color);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-block;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        /* 商店界面 */
        .shop-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .shop-header h2 {
            color: var(--primary-color);
            font-size: 28px;
        }

        .shop-tabs {
            display: flex;
            background-color: #f1f3f6;
            border-radius: 10px;
            overflow: hidden;
        }

        .shop-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .shop-tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .shop-content {
            display: none;
        }

        .shop-content.active {
            display: block;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .shop-item {
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .shop-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .shop-item-img {
            height: 180px;
            background-color: #f8f9fa;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .shop-item-img img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .shop-item-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--accent-color);
            color: white;
            padding: 4px 10px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: bold;
        }

        .shop-item-info {
            padding: 20px;
        }

        .shop-item-info h3 {
            font-size: 18px;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .shop-item-info p {
            color: #6c757d;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .shop-item-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shop-item-price {
            display: flex;
            align-items: center;
            font-weight: bold;
            color: var(--accent-color);
        }

        .shop-item-price i {
            margin-right: 5px;
        }

        .shop-item-btn {
            padding: 8px 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .shop-item-btn:hover {
            background-color: #3a5bef;
        }

        .shop-item-btn.owned {
            background-color: var(--success-color);
        }

        .shop-item-btn.equipped {
            background-color: var(--info-color);
        }

        /* 排行榜界面 */
        .leaderboard-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .leaderboard-header h2 {
            color: var(--primary-color);
            font-size: 28px;
            margin-bottom: 30px;
        }

        .leaderboard-tabs {
            display: flex;
            background-color: #f1f3f6;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .leaderboard-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .leaderboard-tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .leaderboard-content {
            display: none;
        }

        .leaderboard-content.active {
            display: block;
        }

        .leaderboard-table {
            width: 100%;
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }

        .leaderboard-table thead {
            background-color: var(--primary-color);
            color: white;
        }

        .leaderboard-table th {
            padding: 15px;
            text-align: left;
        }

        .leaderboard-table tbody tr {
            border-bottom: 1px solid #f1f3f6;
            transition: all 0.3s ease;
        }

        .leaderboard-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .leaderboard-table td {
            padding: 15px;
        }

        .leaderboard-rank {
            font-weight: bold;
            color: var(--primary-color);
            width: 50px;
        }

        .leaderboard-user {
            display: flex;
            align-items: center;
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }

        .leaderboard-name {
            font-weight: bold;
        }

        .leaderboard-score {
            font-weight: bold;
            color: var(--accent-color);
        }

        .leaderboard-you {
            background-color: rgba(74, 107, 255, 0.1);
        }

        /* 设置界面 */
        .settings-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .settings-header h2 {
            color: var(--primary-color);
            font-size: 28px;
            margin-bottom: 30px;
        }

        .settings-card {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .settings-card h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
        }

        .settings-card h3 i {
            margin-right: 10px;
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: var(--dark-color);
        }

        .settings-group input[type="text"],
        .settings-group input[type="password"],
        .settings-group input[type="email"],
        .settings-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e3e7;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .settings-group input:focus,
        .settings-group select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(74, 107, 255, 0.2);
            outline: none;
        }

        .settings-avatar {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .settings-avatar-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-right: 20px;
            object-fit: cover;
            border: 3px solid #e0e3e7;
        }

        .settings-avatar-options {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(60px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .settings-avatar-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            object-fit: cover;
            border: 2px solid #e0e3e7;
            transition: all 0.3s ease;
        }

        .settings-avatar-option:hover,
        .settings-avatar-option.selected {
            border-color: var(--primary-color);
            transform: scale(1.05);
        }

        .settings-buttons {
            display: flex;
            gap: 15px;
        }

        .settings-btn {
            padding: 12px 24px;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .settings-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .settings-btn.danger {
            background-color: var(--danger-color);
            color: white;
        }

        .settings-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        /* 管理员界面 */
        .admin-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .admin-header h2 {
            color: var(--primary-color);
            font-size: 28px;
            margin-bottom: 30px;
        }

        .admin-tabs {
            display: flex;
            background-color: #f1f3f6;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }

        .admin-tab.active {
            background-color: var(--primary-color);
            color: white;
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .admin-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .admin-stat {
            background-color: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            text-align: center;
        }

        .admin-stat h3 {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 10px;
        }

        .admin-stat p {
            font-size: 24px;
            font-weight: bold;
            color: var(--primary-color);
        }

        .admin-table {
            width: 100%;
            background-color: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .admin-table thead {
            background-color: var(--primary-color);
            color: white;
        }

        .admin-table th {
            padding: 15px;
            text-align: left;
        }

        .admin-table tbody tr {
            border-bottom: 1px solid #f1f3f6;
        }

        .admin-table td {
            padding: 15px;
        }

        .admin-user {
            display: flex;
            align-items: center;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            margin-right: 10px;
            object-fit: cover;
        }

        .admin-actions {
            display: flex;
            gap: 10px;
        }

        .admin-btn {
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .admin-btn.primary {
            background-color: var(--primary-color);
            color: white;
        }

        .admin-btn.success {
            background-color: var(--success-color);
            color: white;
        }

        .admin-btn.danger {
            background-color: var(--danger-color);
            color: white;
        }

        .admin-btn.warning {
            background-color: var(--warning-color);
            color: var(--dark-color);
        }

        .admin-btn:hover {
            opacity: 0.9;
            transform: translateY(-2px);
        }

        /* 开发者模式 */
        .dev-container {
            display: none;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .dev-header h2 {
            color: var(--primary-color);
            font-size: 28px;
            margin-bottom: 30px;
        }

        .dev-card {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }

        .dev-card h3 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 20px;
            display: flex;
            align-items: center;
        }

        .dev-card h3 i {
            margin-right: 10px;
        }

        .dev-code-editor {
            width: 100%;
            height: 300px;
            border: 2px solid #e0e3e7;
            border-radius: 10px;
            padding: 15px;
            font-family: monospace;
            font-size: 14px;
            resize: vertical;
            margin-bottom: 15px;
        }

        .dev-buttons {
            display: flex;
            gap: 15px;
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.3s ease;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .modal-close:hover {
            color: var(--danger-color);
            transform: rotate(90deg);
        }

        .modal-header h3 {
            color: var(--primary-color);
            font-size: 24px;
            margin-bottom: 15px;
        }

        .modal-body {
            margin-bottom: 25px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .stats-cards {
                grid-template-columns: 1fr 1fr;
            }

            .leaderboard-table th:nth-child(3),
            .leaderboard-table td:nth-child(3) {
                display: none;
            }

            .mobile-controls {
                display: block;
            }
        }

        @media (max-width: 576px) {
            .auth-box {
                padding: 20px;
            }

            .stats-cards {
                grid-template-columns: 1fr;
            }

            .action-buttons {
                grid-template-columns: 1fr 1fr;
            }

            .game-over-buttons {
                flex-direction: column;
            }

            .settings-buttons {
                flex-direction: column;
            }

            .modal-footer {
                flex-direction: column;
            }
        }

        /* 动画效果 */
        .bounce {
            animation: bounce 0.5s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-10px); }
        }

        .shake {
            animation: shake 0.5s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* 工具类 */
        .text-primary {
            color: var(--primary-color);
        }

        .text-success {
            color: var(--success-color);
        }

        .text-danger {
            color: var(--danger-color);
        }

        .text-warning {
            color: var(--warning-color);
        }

        .text-info {
            color: var(--info-color);
        }

        .text-center {
            text-align: center;
        }

        .mt-10 {
            margin-top: 10px;
        }

        .mt-20 {
            margin-top: 20px;
        }

        .mb-10 {
            margin-bottom: 10px;
        }

        .mb-20 {
            margin-bottom: 20px;
        }

        .hidden {
            display: none;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- 登录注册界面 -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <h1>炸弹躲避大冒险</h1>
            <div class="auth-tabs">
                <div class="auth-tab active" id="loginTab">登录</div>
                <div class="auth-tab" id="registerTab">注册</div>
            </div>
            <form class="auth-form active" id="loginForm">
                <div class="form-group">
                    <label for="loginUsername">用户名</label>
                    <input type="text" id="loginUsername" class="form-control" placeholder="请输入用户名">
                </div>
                <div class="form-group">
                    <label for="loginPassword">密码</label>
                    <input type="password" id="loginPassword" class="form-control" placeholder="请输入密码">
                </div>
                <div class="remember-me">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">30天内自动登录</label>
                </div>
                <button type="button" class="btn" id="loginBtn">登录</button>
                <div class="auth-footer">
                    <p>还没有账号？<a href="#" id="switchToRegister">立即注册</a></p>
                </div>
            </form>
            <form class="auth-form" id="registerForm">
                <div class="form-group">
                    <label for="registerUsername">用户名</label>
                    <input type="text" id="registerUsername" class="form-control" placeholder="请输入用户名">
                </div>
                <div class="form-group">
                    <label for="registerPassword">密码</label>
                    <input type="password" id="registerPassword" class="form-control" placeholder="请输入密码">
                </div>
                <div class="form-group">
                    <label for="registerConfirmPassword">确认密码</label>
                    <input type="password" id="registerConfirmPassword" class="form-control" placeholder="请再次输入密码">
                </div>
                <button type="button" class="btn" id="registerBtn">注册</button>
                <div class="auth-footer">
                    <p>已有账号？<a href="#" id="switchToLogin">立即登录</a></p>
                </div>
            </form>
        </div>
    </div>

    <!-- 主界面 -->
    <div class="main-container" id="mainContainer">
        <div class="header">
            <div class="logo">
                <img id="userAvatarImg" src="https://via.placeholder.com/40" alt="头像">
                <span id="usernameDisplay">用户名</span>
                <span class="admin-badge hidden" id="adminBadge">管理</span>
                <span class="vip-badge hidden" id="vipBadge">VIP</span>
            </div>
            <div class="user-menu">
                <img src="https://via.placeholder.com/40" alt="用户头像" class="user-avatar" id="userMenuAvatar">
                <div class="dropdown-menu" id="dropdownMenu">
                    <div class="dropdown-item" id="profileBtn">
                        <i class="fas fa-user"></i>个人资料
                    </div>
                    <div class="dropdown-item" id="settingsBtn">
                        <i class="fas fa-cog"></i>设置
                    </div>
                    <div class="dropdown-item hidden" id="adminBtn">
                        <i class="fas fa-shield-alt"></i>管理员面板
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i>退出登录
                    </div>
                </div>
            </div>
        </div>

        <!-- 主页内容 -->
        <div class="home-content" id="homeContent">
            <div class="welcome-section">
                <div class="welcome-content">
                    <h2>欢迎回来, <span id="welcomeUsername">玩家</span>!</h2>
                    <p>准备好开始新的冒险了吗？躲避炸弹，收集金币和钥匙，创造新的记录！</p>
                </div>
            </div>

            <div class="stats-cards">
                <div class="stat-card">
                    <div class="stat-icon coins">
                        <i class="fas fa-coins"></i>
                    </div>
                    <div class="stat-info">
                        <h3>金币</h3>
                        <p id="coinsStat">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon keys">
                        <i class="fas fa-key"></i>
                    </div>
                    <div class="stat-info">
                        <h3>钥匙</h3>
                        <p id="keysStat">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon score">
                        <i class="fas fa-trophy"></i>
                    </div>
                    <div class="stat-info">
                        <h3>最高分</h3>
                        <p id="highscoreStat">0</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon lives">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-info">
                        <h3>生命</h3>
                        <p id="livesStat">0</p>
                    </div>
                </div>
            </div>

            <div class="action-buttons">
                <button class="action-btn play" id="playBtn">
                    <i class="fas fa-play"></i>
                    <h3>开始游戏</h3>
                    <p>躲避炸弹，创造高分</p>
                </button>
                <button class="action-btn shop" id="shopBtn">
                    <i class="fas fa-shopping-cart"></i>
                    <h3>商店</h3>
                    <p>购买皮肤和道具</p>
                </button>
                <button class="action-btn leaderboard" id="leaderboardBtn">
                    <i class="fas fa-medal"></i>
                    <h3>排行榜</h3>
                    <p>查看全球排名</p>
                </button>
                <button class="action-btn settings" id="homeSettingsBtn">
                    <i class="fas fa-cog"></i>
                    <h3>设置</h3>
                    <p>调整游戏设置</p>
                </button>
            </div>
        </div>

        <!-- 游戏界面 -->
        <div class="game-container" id="gameContainer">
            <canvas id="gameCanvas"></canvas>
            <div class="game-ui">
                <div class="game-stat coins">
                    <i class="fas fa-coins"></i>
                    <span id="gameCoins">0</span>
                </div>
                <div class="game-stat keys">
                    <i class="fas fa-key"></i>
                    <span id="gameKeys">0</span>
                </div>
                <div class="game-stat lives">
                    <i class="fas fa-heart"></i>
                    <span id="gameLives">3</span>
                </div>
                <div class="game-stat score">
                    <i class="fas fa-trophy"></i>
                    <span id="gameScore">0</span>
                </div>
            </div>
            <div class="mobile-controls">
                <div class="mobile-controls-grid">
                    <button class="mobile-btn up" id="mobileUp"><i class="fas fa-arrow-up"></i></button>
                    <button class="mobile-btn left" id="mobileLeft"><i class="fas fa-arrow-left"></i></button>
                    <button class="mobile-btn down" id="mobileDown"><i class="fas fa-arrow-down"></i></button>
                    <button class="mobile-btn right" id="mobileRight"><i class="fas fa-arrow-right"></i></button>
                </div>
                <button class="mobile-btn pause" id="mobilePause"><i class="fas fa-pause"></i></button>
            </div>
            <div class="game-over" id="gameOver">
                <div class="game-over-content">
                    <h2>游戏结束</h2>
                    <div class="new-highscore hidden" id="newHighscore">新纪录!</div>
                    <p>你的最终得分是 <span id="finalScore" class="text-primary">0</span></p>
                    <div class="game-over-stats">
                        <div class="game-over-stat">
                            <h3>收集金币</h3>
                            <p id="finalCoins" class="text-warning">0</p>
                        </div>
                        <div class="game-over-stat">
                            <h3>收集钥匙</h3>
                            <p id="finalKeys" class="text-success">0</p>
                        </div>
                        <div class="game-over-stat">
                            <h3>最高分</h3>
                            <p id="finalHighscore" class="text-info">0</p>
                        </div>
                        <div class="game-over-stat">
                            <h3>排名</h3>
                            <p id="finalRank" class="text-primary">#0</p>
                        </div>
                    </div>
                    <div class="game-over-buttons">
                        <button class="game-over-btn primary" id="playAgainBtn">再来一局</button>
                        <button class="game-over-btn secondary" id="backToHomeBtn">返回主页</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 商店界面 -->
        <div class="shop-container" id="shopContainer">
            <div class="shop-header">
                <h2>商店</h2>
                <div class="shop-tabs">
                    <div class="shop-tab active" data-tab="skins">皮肤</div>
                    <div class="shop-tab" data-tab="avatars">头像</div>
                    <div class="shop-tab" data-tab="powerups">道具</div>
                </div>
            </div>
            <div class="shop-content active" data-content="skins">
                <div class="shop-items" id="skinsItems">
                    <!-- 皮肤项将通过JS动态生成 -->
                </div>
            </div>
            <div class="shop-content" data-content="avatars">
                <div class="shop-items" id="avatarsItems">
                    <!-- 头像项将通过JS动态生成 -->
                </div>
            </div>
            <div class="shop-content" data-content="powerups">
                <div class="shop-items" id="powerupsItems">
                    <!-- 道具项将通过JS动态生成 -->
                </div>
            </div>
        </div>

        <!-- 排行榜界面 -->
        <div class="leaderboard-container" id="leaderboardContainer">
            <div class="leaderboard-header">
                <h2>排行榜</h2>
                <div class="leaderboard-tabs">
                    <div class="leaderboard-tab active" data-tab="global">全球榜</div>
                    <div class="leaderboard-tab" data-tab="friends">好友榜</div>
                    <div class="leaderboard-tab" data-tab="today">今日榜</div>
                </div>
            </div>
            <div class="leaderboard-content active" data-content="global">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>排名</th>
                            <th>玩家</th>
                            <th>分数</th>
                            <th>日期</th>
                        </tr>
                    </thead>
                    <tbody id="globalLeaderboard">
                        <!-- 排行榜数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
            <div class="leaderboard-content" data-content="friends">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>排名</th>
                            <th>玩家</th>
                            <th>分数</th>
                            <th>日期</th>
                        </tr>
                    </thead>
                    <tbody id="friendsLeaderboard">
                        <!-- 排行榜数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
            <div class="leaderboard-content" data-content="today">
                <table class="leaderboard-table">
                    <thead>
                        <tr>
                            <th>排名</th>
                            <th>玩家</th>
                            <th>分数</th>
                            <th>时间</th>
                        </tr>
                    </thead>
                    <tbody id="todayLeaderboard">
                        <!-- 排行榜数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- 设置界面 -->
        <div class="settings-container" id="settingsContainer">
            <div class="settings-header">
                <h2>设置</h2>
            </div>
            <div class="settings-card">
                <h3><i class="fas fa-user-cog"></i>个人资料</h3>
                <div class="settings-group">
                    <label for="nickname">昵称</label>
                    <input type="text" id="nickname" class="form-control" placeholder="请输入昵称">
                </div>
                <div class="settings-avatar">
                    <img src="https://via.placeholder.com/80" alt="头像" class="settings-avatar-img" id="currentAvatarImg">
                    <div>
                        <button class="btn" id="changeAvatarBtn">更改头像</button>
                        <p class="mt-10">选择一个预设头像或上传自定义头像</p>
                    </div>
                </div>
                <div class="settings-avatar-options" id="avatarOptions">
                    <!-- 头像选项将通过JS动态生成 -->
                </div>
                <div class="settings-group hidden" id="customAvatarGroup">
                    <label for="customAvatar">自定义头像</label>
                    <input type="file" id="customAvatar" class="form-control" accept="image/*">
                </div>
                <div class="settings-buttons mt-20">
                    <button class="settings-btn primary" id="saveProfileBtn">保存更改</button>
                </div>
            </div>
            <div class="settings-card">
                <h3><i class="fas fa-gamepad"></i>游戏设置</h3>
                <div class="settings-group">
                    <label for="controls">控制方式</label>
                    <select id="controls" class="form-control">
                        <option value="keyboard">键盘控制</option>
                        <option value="touch">触摸控制</option>
                    </select>
                </div>
                <div class="settings-group">
                    <label for="soundVolume">音效音量</label>
                    <input type="range" id="soundVolume" class="form-control" min="0" max="100" value="50">
                </div>
                <div class="settings-group">
                    <label for="musicVolume">音乐音量</label>
                    <input type="range" id="musicVolume" class="form-control" min="0" max="100" value="30">
                </div>
                <div class="settings-buttons mt-20">
                    <button class="settings-btn primary" id="saveSettingsBtn">保存设置</button>
                </div>
            </div>
            <div class="settings-card">
                <h3><i class="fas fa-user-shield"></i>账户安全</h3>
                <div class="settings-group">
                    <label for="currentPassword">当前密码</label>
                    <input type="password" id="currentPassword" class="form-control" placeholder="请输入当前密码">
                </div>
                <div class="settings-group">
                    <label for="newPassword">新密码</label>
                    <input type="password" id="newPassword" class="form-control" placeholder="请输入新密码">
                </div>
                <div class="settings-group">
                    <label for="confirmNewPassword">确认新密码</label>
                    <input type="password" id="confirmNewPassword" class="form-control" placeholder="请再次输入新密码">
                </div>
                <div class="settings-buttons mt-20">
                    <button class="settings-btn primary" id="changePasswordBtn">更改密码</button>
                </div>
            </div>
            <div class="settings-card">
                <h3><i class="fas fa-gem"></i>VIP会员</h3>
                <p>成为VIP会员，享受专属皮肤、头像和游戏特权！</p>
                <div class="shop-items mt-20">
                    <div class="shop-item">
                        <div class="shop-item-img" style="background-color: #f8f9fa;">
                            <i class="fas fa-crown" style="font-size: 60px; color: #feca57;"></i>
                        </div>
                        <div class="shop-item-info">
                            <h3>VIP会员 (包月)</h3>
                            <p>解锁所有VIP专属内容，有效期30天</p>
                            <div class="shop-item-footer">
                                <div class="shop-item-price">
                                    <i class="fas fa-coins"></i> 200
                                </div>
                                <button class="shop-item-btn" id="buyVipMonthlyBtn">购买</button>
                            </div>
                        </div>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-img" style="background-color: #f8f9fa;">
                            <i class="fas fa-crown" style="font-size: 60px; color: #feca57;"></i>
                        </div>
                        <div class="shop-item-info">
                            <h3>VIP会员 (包年)</h3>
                            <p>解锁所有VIP专属内容，有效期365天</p>
                            <div class="shop-item-footer">
                                <div class="shop-item-price">
                                    <i class="fas fa-coins"></i> 1000
                                </div>
                                <button class="shop-item-btn" id="buyVipYearlyBtn">购买</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 管理员界面 -->
        <div class="admin-container" id="adminContainer">
            <div class="admin-header">
                <h2>管理员面板</h2>
                <div class="admin-tabs">
                    <div class="admin-tab active" data-tab="users">用户管理</div>
                    <div class="admin-tab" data-tab="reports">举报管理</div>
                    <div class="admin-tab" data-tab="stats">统计数据</div>
                </div>
            </div>
            <div class="admin-content active" data-content="users">
                <div class="form-group">
                    <input type="text" id="adminSearchUser" class="form-control" placeholder="搜索用户名...">
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>用户名</th>
                            <th>注册日期</th>
                            <th>最高分</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="adminUsersTable">
                        <!-- 用户数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
            <div class="admin-content" data-content="reports">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>举报ID</th>
                            <th>举报用户</th>
                            <th>被举报用户</th>
                            <th>原因</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="adminReportsTable">
                        <!-- 举报数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
            <div class="admin-content" data-content="stats">
                <div class="admin-stats">
                    <div class="admin-stat">
                        <h3>总用户数</h3>
                        <p id="totalUsers">0</p>
                    </div>
                    <div class="admin-stat">
                        <h3>今日活跃</h3>
                        <p id="activeToday">0</p>
                    </div>
                    <div class="admin-stat">
                        <h3>总游戏次数</h3>
                        <p id="totalGames">0</p>
                    </div>
                    <div class="admin-stat">
                        <h3>总金币</h3>
                        <p id="totalCoins">0</p>
                    </div>
                </div>
                <div class="settings-buttons">
                    <button class="settings-btn danger" id="exportDataBtn">导出数据</button>
                </div>
            </div>
        </div>

        <!-- 开发者模式 -->
        <div class="dev-container" id="devContainer">
            <div class="dev-header">
                <h2>开发者模式</h2>
            </div>
            <div class="dev-card">
                <h3><i class="fas fa-users-cog"></i>账户管理</h3>
                <div class="form-group">
                    <input type="text" id="devSearchUser" class="form-control" placeholder="搜索用户名...">
                </div>
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>用户名</th>
                            <th>注册日期</th>
                            <th>状态</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="devUsersTable">
                        <!-- 用户数据将通过JS动态生成 -->
                    </tbody>
                </table>
            </div>
            <div class="dev-card">
                <h3><i class="fas fa-code"></i>网站更新</h3>
                <textarea class="dev-code-editor" id="devCodeEditor" placeholder="在此处输入HTML代码..."></textarea>
                <div class="dev-buttons">
                    <button class="settings-btn primary" id="previewUpdateBtn">预览更新</button>
                    <button class="settings-btn success" id="publishUpdateBtn">发布更新</button>
                </div>
            </div>
            <div class="dev-card">
                <h3><i class="fas fa-tools"></i>开发者工具</h3>
                <div class="settings-buttons">
                    <button class="settings-btn primary" id="clearDataBtn">清除所有数据</button>
                    <button class="settings-btn warning" id="resetGameBtn">重置游戏数据</button>
                    <button class="settings-btn danger" id="migrateDataBtn">迁移数据</button>
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div class="modal" id="keyModal">
        <div class="modal-content">
            <span class="modal-close" id="closeKeyModal">&times;</span>
            <div class="modal-header">
                <h3>使用钥匙</h3>
            </div>
            <div class="modal-body">
                <p>你被炸弹击中了！是否使用钥匙来继续游戏？</p>
                <p>当前钥匙数量: <span id="modalKeyCount">0</span></p>
            </div>
            <div class="modal-footer">
                <button class="btn" id="useKeyBtn">使用钥匙</button>
                <button class="btn" id="dontUseKeyBtn" style="background-color: #e9ecef; color: #495057;">不使用</button>
            </div>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <span class="modal-close" id="closeConfirmModal">&times;</span>
            <div class="modal-header">
                <h3 id="confirmModalTitle">确认操作</h3>
            </div>
            <div class="modal-body">
                <p id="confirmModalMessage">你确定要执行此操作吗？</p>
            </div>
            <div class="modal-footer">
                <button class="btn" id="confirmModalYesBtn">确定</button>
                <button class="btn" id="confirmModalNoBtn" style="background-color: #e9ecef; color: #495057;">取消</button>
            </div>
        </div>
    </div>

    <div class="modal" id="messageModal">
        <div class="modal-content">
            <span class="modal-close" id="closeMessageModal">&times;</span>
            <div class="modal-header">
                <h3 id="messageModalTitle">消息</h3>
            </div>
            <div class="modal-body">
                <p id="messageModalMessage">这是一条消息。</p>
            </div>
            <div class="modal-footer">
                <button class="btn" id="messageModalOkBtn">确定</button>
            </div>
        </div>
    </div>

    <div class="modal" id="adminActionModal">
        <div class="modal-content">
            <span class="modal-close" id="closeAdminActionModal">&times;</span>
            <div class="modal-header">
                <h3 id="adminActionModalTitle">管理员操作</h3>
            </div>
            <div class="modal-body">
                <div class="form-group" id="adminActionFormGroup">
                    <!-- 动态表单内容 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" id="adminActionModalConfirmBtn">确认</button>
                <button class="btn" id="adminActionModalCancelBtn" style="background-color: #e9ecef; color: #495057;">取消</button>
            </div>
        </div>
    </div>

    <script>
        // 游戏配置
        const config = {
            playerSize: 40,
            bombSize: 30,
            itemSize: 25,
            initialSpeed: 2,
            speedIncrement: 0.1,
            maxSpeed: 10,
            bombSpawnRate: 60,
            itemSpawnRate: 180,
            gameWidth: window.innerWidth,
            gameHeight: window.innerHeight - 70,
            controls: 'keyboard', // 默认键盘控制
            soundVolume: 50,
            musicVolume: 30
        };

        // 游戏状态
        let gameState = {
            isPlaying: false,
            isPaused: false,
            score: 0,
            coins: 0,
            keys: 0,
            lives: 3,
            speed: config.initialSpeed,
            level: 1,
            bombs: [],
            items: [],
            lastBombSpawn: 0,
            lastItemSpawn: 0,
            keysPressed: {},
            playerX: config.gameWidth / 2 - config.playerSize / 2,
            playerY: config.gameHeight - config.playerSize - 20,
            playerSkin: 'default',
            playerAvatar: 'default',
            isVip: false,
            isAdmin: false,
            isDev: false,
            currentUser: null,
            users: [],
            leaderboard: [],
            shopItems: {
                skins: [],
                avatars: [],
                powerups: []
            },
            gameInterval: null,
            animationFrame: null
        };

        // DOM元素
        const elements = {
            authContainer: document.getElementById('authContainer'),
            mainContainer: document.getElementById('mainContainer'),
            gameContainer: document.getElementById('gameContainer'),
            gameCanvas: document.getElementById('gameCanvas'),
            gameOver: document.getElementById('gameOver'),
            homeContent: document.getElementById('homeContent'),
            shopContainer: document.getElementById('shopContainer'),
            leaderboardContainer: document.getElementById('leaderboardContainer'),
            settingsContainer: document.getElementById('settingsContainer'),
            adminContainer: document.getElementById('adminContainer'),
            devContainer: document.getElementById('devContainer'),
            // 登录注册元素
            loginTab: document.getElementById('loginTab'),
            registerTab: document.getElementById('registerTab'),
            loginForm: document.getElementById('loginForm'),
            registerForm: document.getElementById('registerForm'),
            loginUsername: document.getElementById('loginUsername'),
            loginPassword: document.getElementById('loginPassword'),
            rememberMe: document.getElementById('rememberMe'),
            registerUsername: document.getElementById('registerUsername'),
            registerPassword: document.getElementById('registerPassword'),
            registerConfirmPassword: document.getElementById('registerConfirmPassword'),
            loginBtn: document.getElementById('loginBtn'),
            registerBtn: document.getElementById('registerBtn'),
            switchToLogin: document.getElementById('switchToLogin'),
            switchToRegister: document.getElementById('switchToRegister'),
            // 主界面元素
            usernameDisplay: document.getElementById('usernameDisplay'),
            userAvatarImg: document.getElementById('userAvatarImg'),
            adminBadge: document.getElementById('adminBadge'),
            vipBadge: document.getElementById('vipBadge'),
            userMenuAvatar: document.getElementById('userMenuAvatar'),
            dropdownMenu: document.getElementById('dropdownMenu'),
            profileBtn: document.getElementById('profileBtn'),
            settingsBtn: document.getElementById('settingsBtn'),
            adminBtn: document.getElementById('adminBtn'),
            logoutBtn: document.getElementById('logoutBtn'),
            welcomeUsername: document.getElementById('welcomeUsername'),
            coinsStat: document.getElementById('coinsStat'),
            keysStat: document.getElementById('keysStat'),
            highscoreStat: document.getElementById('highscoreStat'),
            livesStat: document.getElementById('livesStat'),
            playBtn: document.getElementById('playBtn'),
            shopBtn: document.getElementById('shopBtn'),
            leaderboardBtn: document.getElementById('leaderboardBtn'),
            homeSettingsBtn: document.getElementById('homeSettingsBtn'),
            // 游戏界面元素
            gameCoins: document.getElementById('gameCoins'),
            gameKeys: document.getElementById('gameKeys'),
            gameLives: document.getElementById('gameLives'),
            gameScore: document.getElementById('gameScore'),
            mobileUp: document.getElementById('mobileUp'),
            mobileLeft: document.getElementById('mobileLeft'),
            mobileDown: document.getElementById('mobileDown'),
            mobileRight: document.getElementById('mobileRight'),
            mobilePause: document.getElementById('mobilePause'),
            finalScore: document.getElementById('finalScore'),
            finalCoins: document.getElementById('finalCoins'),
            finalKeys: document.getElementById('finalKeys'),
            finalHighscore: document.getElementById('finalHighscore'),
            finalRank: document.getElementById('finalRank'),
            newHighscore: document.getElementById('newHighscore'),
            playAgainBtn: document.getElementById('playAgainBtn'),
            backToHomeBtn: document.getElementById('backToHomeBtn'),
            // 商店元素
            skinsItems: document.getElementById('skinsItems'),
            avatarsItems: document.getElementById('avatarsItems'),
            powerupsItems: document.getElementById('powerupsItems'),
            buyVipMonthlyBtn: document.getElementById('buyVipMonthlyBtn'),
            buyVipYearlyBtn: document.getElementById('buyVipYearlyBtn'),
            // 排行榜元素
            globalLeaderboard: document.getElementById('globalLeaderboard'),
            friendsLeaderboard: document.getElementById('friendsLeaderboard'),
            todayLeaderboard: document.getElementById('todayLeaderboard'),
            // 设置元素
            nickname: document.getElementById('nickname'),
            currentAvatarImg: document.getElementById('currentAvatarImg'),
            changeAvatarBtn: document.getElementById('changeAvatarBtn'),
            avatarOptions: document.getElementById('avatarOptions'),
            customAvatarGroup: document.getElementById('customAvatarGroup'),
            customAvatar: document.getElementById('customAvatar'),
            saveProfileBtn: document.getElementById('saveProfileBtn'),
            controls: document.getElementById('controls'),
            soundVolume: document.getElementById('soundVolume'),
            musicVolume: document.getElementById('musicVolume'),
            saveSettingsBtn: document.getElementById('saveSettingsBtn'),
            currentPassword: document.getElementById('currentPassword'),
            newPassword: document.getElementById('newPassword'),
            confirmNewPassword: document.getElementById('confirmNewPassword'),
            changePasswordBtn: document.getElementById('changePasswordBtn'),
            // 管理员元素
            adminSearchUser: document.getElementById('adminSearchUser'),
            adminUsersTable: document.getElementById('adminUsersTable'),
            adminReportsTable: document.getElementById('adminReportsTable'),
            totalUsers: document.getElementById('totalUsers'),
            activeToday: document.getElementById('activeToday'),
            totalGames: document.getElementById('totalGames'),
            totalCoins: document.getElementById('totalCoins'),
            exportDataBtn: document.getElementById('exportDataBtn'),
            // 开发者元素
            devSearchUser: document.getElementById('devSearchUser'),
            devUsersTable: document.getElementById('devUsersTable'),
            devCodeEditor: document.getElementById('devCodeEditor'),
            previewUpdateBtn: document.getElementById('previewUpdateBtn'),
            publishUpdateBtn: document.getElementById('publishUpdateBtn'),
            clearDataBtn: document.getElementById('clearDataBtn'),
            resetGameBtn: document.getElementById('resetGameBtn'),
            migrateDataBtn: document.getElementById('migrateDataBtn'),
            // 模态框元素
            keyModal: document.getElementById('keyModal'),
            closeKeyModal: document.getElementById('closeKeyModal'),
            modalKeyCount: document.getElementById('modalKeyCount'),
            useKeyBtn: document.getElementById('useKeyBtn'),
            dontUseKeyBtn: document.getElementById('dontUseKeyBtn'),
            confirmModal: document.getElementById('confirmModal'),
            closeConfirmModal: document.getElementById('closeConfirmModal'),
            confirmModalTitle: document.getElementById('confirmModalTitle'),
            confirmModalMessage: document.getElementById('confirmModalMessage'),
            confirmModalYesBtn: document.getElementById('confirmModalYesBtn'),
            confirmModalNoBtn: document.getElementById('confirmModalNoBtn'),
            messageModal: document.getElementById('messageModal'),
            closeMessageModal: document.getElementById('closeMessageModal'),
            messageModalTitle: document.getElementById('messageModalTitle'),
            messageModalMessage: document.getElementById('messageModalMessage'),
            messageModalOkBtn: document.getElementById('messageModalOkBtn'),
            adminActionModal: document.getElementById('adminActionModal'),
            closeAdminActionModal: document.getElementById('closeAdminActionModal'),
            adminActionModalTitle: document.getElementById('adminActionModalTitle'),
            adminActionFormGroup: document.getElementById('adminActionFormGroup'),
            adminActionModalConfirmBtn: document.getElementById('adminActionModalConfirmBtn'),
            adminActionModalCancelBtn: document.getElementById('adminActionModalCancelBtn')
        };

        // 初始化游戏
        function initGame() {
            // 检查本地存储中是否有用户数据
            checkRememberMe();
            
            // 初始化事件监听器
            initEventListeners();
            
            // 初始化游戏画布
            initCanvas();
            
            // 加载游戏数据
            loadGameData();
            
            // 如果是开发者模式，显示开发者面板
            if (window.location.hash === '#dev') {
                showDevMode();
            }
        }

        // 检查记住我功能
        function checkRememberMe() {
            const rememberMe = localStorage.getItem('rememberMe');
            if (rememberMe === 'true') {
                const username = localStorage.getItem('username');
                const password = localStorage.getItem('password');
                if (username && password) {
                    elements.loginUsername.value = username;
                    elements.loginPassword.value = password;
                    elements.rememberMe.checked = true;
                    // 自动登录
                    loginUser(username, password);
                }
            }
        }

        // 初始化事件监听器
        function initEventListeners() {
            // 登录注册切换
            elements.loginTab.addEventListener('click', () => switchAuthTab('login'));
            elements.registerTab.addEventListener('click', () => switchAuthTab('register'));
            elements.switchToLogin.addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('login');
            });
            elements.switchToRegister.addEventListener('click', (e) => {
                e.preventDefault();
                switchAuthTab('register');
            });
            
            // 登录注册按钮
            elements.loginBtn.addEventListener('click', handleLogin);
            elements.registerBtn.addEventListener('click', handleRegister);
            
            // 用户菜单
            elements.userMenuAvatar.addEventListener('click', toggleDropdown);
            document.addEventListener('click', (e) => {
                if (!elements.userMenu.contains(e.target)) {
                    elements.dropdownMenu.classList.remove('show');
                }
            });
            
            // 下拉菜单项
            elements.profileBtn.addEventListener('click', showProfile);
            elements.settingsBtn.addEventListener('click', showSettings);
            elements.adminBtn.addEventListener('click', showAdminPanel);
            elements.logoutBtn.addEventListener('click', logoutUser);
            
            // 主界面按钮
            elements.playBtn.addEventListener('click', startGame);
            elements.shopBtn.addEventListener('click', showShop);
            elements.leaderboardBtn.addEventListener('click', showLeaderboard);
            elements.homeSettingsBtn.addEventListener('click', showSettings);
            
            // 游戏控制
            document.addEventListener('keydown', handleKeyDown);
            document.addEventListener('keyup', handleKeyUp);
            elements.mobileUp.addEventListener('touchstart', () => gameState.keysPressed.ArrowUp = true);
            elements.mobileUp.addEventListener('touchend', () => gameState.keysPressed.ArrowUp = false);
            elements.mobileLeft.addEventListener('touchstart', () => gameState.keysPressed.ArrowLeft = true);
            elements.mobileLeft.addEventListener('touchend', () => gameState.keysPressed.ArrowLeft = false);
            elements.mobileDown.addEventListener('touchstart', () => gameState.keysPressed.ArrowDown = true);
            elements.mobileDown.addEventListener('touchend', () => gameState.keysPressed.ArrowDown = false);
            elements.mobileRight.addEventListener('touchstart', () => gameState.keysPressed.ArrowRight = true);
            elements.mobileRight.addEventListener('touchend', () => gameState.keysPressed.ArrowRight = false);
            elements.mobilePause.addEventListener('click', togglePause);
            
            // 游戏结束按钮
            elements.playAgainBtn.addEventListener('click', startGame);
            elements.backToHomeBtn.addEventListener('click', backToHome);
            
            // 商店标签切换
            document.querySelectorAll('.shop-tab').forEach(tab => {
                tab.addEventListener('click', () => switchShopTab(tab.dataset.tab));
            });
            
            // VIP购买按钮
            elements.buyVipMonthlyBtn.addEventListener('click', () => buyVip('monthly'));
            elements.buyVipYearlyBtn.addEventListener('click', () => buyVip('yearly'));
            
            // 排行榜标签切换
            document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                tab.addEventListener('click', () => switchLeaderboardTab(tab.dataset.tab));
            });
            
            // 设置保存按钮
            elements.saveProfileBtn.addEventListener('click', saveProfile);
            elements.saveSettingsBtn.addEventListener('click', saveSettings);
            elements.changePasswordBtn.addEventListener('click', changePassword);
            
            // 管理员标签切换
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', () => switchAdminTab(tab.dataset.tab));
            });
            
            // 开发者按钮
            elements.previewUpdateBtn.addEventListener('click', previewUpdate);
            elements.publishUpdateBtn.addEventListener('click', publishUpdate);
            elements.clearDataBtn.addEventListener('click', clearAllData);
            elements.resetGameBtn.addEventListener('click', resetGameData);
            elements.migrateDataBtn.addEventListener('click', migrateData);
            
            // 模态框按钮
            elements.closeKeyModal.addEventListener('click', () => hideModal('keyModal'));
            elements.useKeyBtn.addEventListener('click', useKeyToContinue);
            elements.dontUseKeyBtn.addEventListener('click', () => {
                hideModal('keyModal');
                gameOver();
            });
            elements.closeConfirmModal.addEventListener('click', () => hideModal('confirmModal'));
            elements.confirmModalYesBtn.addEventListener('click', confirmAction);
            elements.confirmModalNoBtn.addEventListener('click', () => hideModal('confirmModal'));
            elements.closeMessageModal.addEventListener('click', () => hideModal('messageModal'));
            elements.messageModalOkBtn.addEventListener('click', () => hideModal('messageModal'));
            elements.closeAdminActionModal.addEventListener('click', () => hideModal('adminActionModal'));
            elements.adminActionModalConfirmBtn.addEventListener('click', confirmAdminAction);
            elements.adminActionModalCancelBtn.addEventListener('click', () => hideModal('adminActionModal'));
            
            // 窗口大小改变时调整游戏画布
            window.addEventListener('resize', resizeCanvas);
        }

        // 初始化游戏画布
        function initCanvas() {
            const canvas = elements.gameCanvas;
            canvas.width = config.gameWidth;
            canvas.height = config.gameHeight;
        }

        // 调整画布大小
        function resizeCanvas() {
            config.gameWidth = window.innerWidth;
            config.gameHeight = window.innerHeight - 70;
            elements.gameCanvas.width = config.gameWidth;
            elements.gameCanvas.height = config.gameHeight;
        }

        // 加载游戏数据
        function loadGameData() {
            // 从本地存储加载数据
            const savedData = localStorage.getItem('bombDodgeGameData');
            if (savedData) {
                const data = JSON.parse(savedData);
                
                // 加载用户数据
                if (data.users) {
                    gameState.users = data.users;
                }
                
                // 加载排行榜数据
                if (data.leaderboard) {
                    gameState.leaderboard = data.leaderboard;
                }
                
                // 加载商店物品
                if (data.shopItems) {
                    gameState.shopItems = data.shopItems;
                } else {
                    // 初始化商店物品
                    initShopItems();
                }
            } else {
                // 初始化默认数据
                initDefaultData();
            }
            
            // 如果当前有用户登录，更新UI
            if (gameState.currentUser) {
                updateUserUI();
            }
        }

        // 初始化默认数据
        function initDefaultData() {
            // 默认用户 (开发者账户)
            const devUser = {
                id: 1,
                username: 'developer',
                password: '19996837879gxhbsh',
                nickname: '开发者',
                avatar: 'dev',
                coins: 999999,
                keys: 999999,
                highscore: 0,
                lives: 3,
                isAdmin: true,
                isDev: true,
                isVip: true,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            
            // 默认商店物品
            initShopItems();
            
            // 初始化用户数组
            gameState.users = [devUser];
            
            // 初始化排行榜
            gameState.leaderboard = [];
            
            // 保存数据
            saveGameData();
        }

        // 初始化商店物品
        function initShopItems() {
            // 皮肤
            gameState.shopItems.skins = [
                { id: 'default', name: '默认皮肤', price: 0, owned: true, equipped: true, image: 'player.png', vip: false },
                { id: 'red', name: '红色皮肤', price: 100, owned: false, equipped: false, image: 'player_red.png', vip: false },
                { id: 'blue', name: '蓝色皮肤', price: 100, owned: false, equipped: false, image: 'player_blue.png', vip: false },
                { id: 'green', name: '绿色皮肤', price: 100, owned: false, equipped: false, image: 'player_green.png', vip: false },
                { id: 'gold', name: '黄金皮肤', price: 500, owned: false, equipped: false, image: 'player_gold.png', vip: false },
                { id: 'vip1', name: 'VIP皮肤1', price: 200, owned: false, equipped: false, image: 'player_vip1.png', vip: true },
                { id: 'vip2', name: 'VIP皮肤2', price: 300, owned: false, equipped: false, image: 'player_vip2.png', vip: true }
            ];
            
            // 头像
            gameState.shopItems.avatars = [
                { id: 'default', name: '默认头像', price: 0, owned: true, equipped: true, image: 'avatar_default.png', vip: false },
                { id: 'cat', name: '猫咪头像', price: 50, owned: false, equipped: false, image: 'avatar_cat.png', vip: false },
                { id: 'dog', name: '狗狗头像', price: 50, owned: false, equipped: false, image: 'avatar_dog.png', vip: false },
                { id: 'panda', name: '熊猫头像', price: 50, owned: false, equipped: false, image: 'avatar_panda.png', vip: false },
                { id: 'lion', name: '狮子头像', price: 150, owned: false, equipped: false, image: 'avatar_lion.png', vip: false },
                { id: 'vip1', name: 'VIP头像1', price: 200, owned: false, equipped: false, image: 'avatar_vip1.png', vip: true },
                { id: 'vip2', name: 'VIP头像2', price: 300, owned: false, equipped: false, image: 'avatar_vip2.png', vip: true }
            ];
            
            // 道具
            gameState.shopItems.powerups = [
                { id: 'life', name: '额外生命', price: 200, owned: false, equipped: false, image: 'life.png', vip: false },
                { id: 'key', name: '钥匙', price: 150, owned: false, equipped: false, image: 'key.png', vip: false },
                { id: 'speed', name: '速度提升', price: 100, owned: false, equipped: false, image: 'speed.png', vip: false },
                { id: 'vip_life', name: 'VIP生命', price: 300, owned: false, equipped: false, image: 'vip_life.png', vip: true }
            ];
        }

        // 保存游戏数据
        function saveGameData() {
            const data = {
                users: gameState.users,
                leaderboard: gameState.leaderboard,
                shopItems: gameState.shopItems
            };
            localStorage.setItem('bombDodgeGameData', JSON.stringify(data));
        }

        // 切换认证标签
        function switchAuthTab(tab) {
            if (tab === 'login') {
                elements.loginTab.classList.add('active');
                elements.registerTab.classList.remove('active');
                elements.loginForm.classList.add('active');
                elements.registerForm.classList.remove('active');
            } else {
                elements.loginTab.classList.remove('active');
                elements.registerTab.classList.add('active');
                elements.loginForm.classList.remove('active');
                elements.registerForm.classList.add('active');
            }
        }

        // 处理登录
        function handleLogin() {
            const username = elements.loginUsername.value.trim();
            const password = elements.loginPassword.value.trim();
            const rememberMe = elements.rememberMe.checked;
            
            if (!username || !password) {
                showMessage('错误', '请输入用户名和密码');
                return;
            }
            
            // 检查是否是开发者账户
            if (username === '3530388417' && password === '19996837879gxh') {
                // 开发者账户
                const devUser = {
                    id: Date.now(),
                    username: 'developer',
                    password: '19996837879gxhbsh',
                    nickname: '开发者',
                    avatar: 'dev',
                    coins: 999999,
                    keys: 999999,
                    highscore: 0,
                    lives: 3,
                    isAdmin: true,
                    isDev: true,
                    isVip: true,
                    createdAt: new Date().toISOString(),
                    lastLogin: new Date().toISOString()
                };
                
                // 检查是否已存在开发者账户
                const existingDev = gameState.users.find(u => u.isDev);
                if (!existingDev) {
                    gameState.users.push(devUser);
                    saveGameData();
                }
                
                loginUser('developer', '19996837879gxhbsh', rememberMe);
                return;
            }
            
            loginUser(username, password, rememberMe);
        }

        // 登录用户
        function loginUser(username, password, rememberMe = false) {
            const user = gameState.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                // 更新最后登录时间
                user.lastLogin = new Date().toISOString();
                saveGameData();
                
                // 设置当前用户
                gameState.currentUser = user;
                gameState.isAdmin = user.isAdmin || false;
                gameState.isDev = user.isDev || false;
                gameState.isVip = user.isVip || false;
                
                // 记住我功能
                if (rememberMe) {
                    localStorage.setItem('rememberMe', 'true');
                    localStorage.setItem('username', username);
                    localStorage.setItem('password', password);
                } else {
                    localStorage.removeItem('rememberMe');
                    localStorage.removeItem('username');
                    localStorage.removeItem('password');
                }
                
                // 更新UI
                updateUserUI();
                
                // 切换到主界面
                elements.authContainer.style.display = 'none';
                elements.mainContainer.style.display = 'block';
                showHome();
            } else {
                showMessage('错误', '用户名或密码不正确');
            }
        }

        // 处理注册
        function handleRegister() {
            const username = elements.registerUsername.value.trim();
            const password = elements.registerPassword.value.trim();
            const confirmPassword = elements.registerConfirmPassword.value.trim();
            
            if (!username || !password || !confirmPassword) {
                showMessage('错误', '请填写所有字段');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('错误', '两次输入的密码不一致');
                return;
            }
            
            if (username.length < 4 || username.length > 16) {
                showMessage('错误', '用户名长度应在4-16个字符之间');
                return;
            }
            
            if (password.length < 6) {
                showMessage('错误', '密码长度应至少为6个字符');
                return;
            }
            
            // 检查用户名是否已存在
            const userExists = gameState.users.some(u => u.username === username);
            if (userExists) {
                showMessage('错误', '用户名已存在');
                return;
            }
            
            // 创建新用户
            const newUser = {
                id: Date.now(),
                username,
                password,
                nickname: username,
                avatar: 'default',
                coins: 50,
                keys: 1,
                highscore: 0,
                lives: 3,
                isAdmin: false,
                isDev: false,
                isVip: false,
                createdAt: new Date().toISOString(),
                lastLogin: new Date().toISOString()
            };
            
            // 添加到用户列表
            gameState.users.push(newUser);
            saveGameData();
            
            // 自动登录
            loginUser(username, password);
            
            // 切换到登录标签
            switchAuthTab('login');
            
            // 清空注册表单
            elements.registerUsername.value = '';
            elements.registerPassword.value = '';
            elements.registerConfirmPassword.value = '';
            
            showMessage('成功', '注册成功！获得50金币和1把钥匙作为新手奖励');
        }

        // 更新用户UI
        function updateUserUI() {
            if (!gameState.currentUser) return;
            
            const user = gameState.currentUser;
            
            // 更新用户名显示
            elements.usernameDisplay.textContent = user.nickname || user.username;
            elements.welcomeUsername.textContent = user.nickname || user.username;
            
            // 更新头像
            updateAvatar(user.avatar);
            
            // 更新统计信息
            elements.coinsStat.textContent = user.coins;
            elements.keysStat.textContent = user.keys;
            elements.highscoreStat.textContent = user.highscore;
            elements.livesStat.textContent = user.lives;
            
            // 更新管理员/VIP徽章
            if (user.isAdmin) {
                elements.adminBadge.classList.remove('hidden');
            } else {
                elements.adminBadge.classList.add('hidden');
            }
            
            if (user.isVip) {
                elements.vipBadge.classList.remove('hidden');
            } else {
                elements.vipBadge.classList.add('hidden');
            }
            
            // 显示/隐藏管理员按钮
            if (user.isAdmin) {
                elements.adminBtn.classList.remove('hidden');
            } else {
                elements.adminBtn.classList.add('hidden');
            }
            
            // 更新设置表单
            elements.nickname.value = user.nickname || user.username;
            
            // 更新商店和排行榜
            updateShopItems();
            updateLeaderboard();
        }

        // 更新头像
        function updateAvatar(avatarId) {
            // 在实际应用中，这里应该使用实际的图片路径
            const avatarUrl = `images/avatars/${avatarId}.png`;
            
            // 更新所有头像显示
            elements.userAvatarImg.src = avatarUrl;
            elements.userMenuAvatar.src = avatarUrl;
            elements.currentAvatarImg.src = avatarUrl;
        }

        // 切换下拉菜单
        function toggleDropdown() {
            elements.dropdownMenu.classList.toggle('show');
        }

        // 显示个人资料
        function showProfile() {
            toggleDropdown();
            showSettings();
        }

        // 显示设置
        function showSettings() {
            hideAllContent();
            elements.settingsContainer.style.display = 'block';
            
            // 更新头像选项
            updateAvatarOptions();
            
            // 更新设置
            elements.controls.value = config.controls;
            elements.soundVolume.value = config.soundVolume;
            elements.musicVolume.value = config.musicVolume;
        }

        // 更新头像选项
        function updateAvatarOptions() {
            elements.avatarOptions.innerHTML = '';
            
            // 添加默认头像选项
            gameState.shopItems.avatars.forEach(avatar => {
                if (avatar.owned || (avatar.vip && gameState.currentUser.isVip) || gameState.currentUser.isDev) {
                    const avatarOption = document.createElement('img');
                    avatarOption.src = `images/avatars/${avatar.image}`;
                    avatarOption.alt = avatar.name;
                    avatarOption.title = avatar.name;
                    avatarOption.classList.add('settings-avatar-option');
                    if (avatar.id === gameState.currentUser.avatar) {
                        avatarOption.classList.add('selected');
                    }
                    avatarOption.addEventListener('click', () => selectAvatar(avatar.id));
                    elements.avatarOptions.appendChild(avatarOption);
                }
            });
        }

        // 选择头像
        function selectAvatar(avatarId) {
            gameState.currentUser.avatar = avatarId;
            updateAvatar(avatarId);
            updateAvatarOptions();
        }

        // 显示管理员面板
        function showAdminPanel() {
            toggleDropdown();
            hideAllContent();
            elements.adminContainer.style.display = 'block';
            
            // 更新用户表格
            updateAdminUsersTable();
        }

        // 更新管理员用户表格
        function updateAdminUsersTable() {
            elements.adminUsersTable.innerHTML = '';
            
            gameState.users.forEach(user => {
                const tr = document.createElement('tr');
                
                // 用户名和头像
                const userTd = document.createElement('td');
                const userDiv = document.createElement('div');
                userDiv.classList.add('admin-user');
                const avatarImg = document.createElement('img');
                avatarImg.src = `images/avatars/${user.avatar}.png`;
                avatarImg.classList.add('admin-avatar');
                const nameSpan = document.createElement('span');
                nameSpan.textContent = user.nickname || user.username;
                if (user.isAdmin) {
                    const adminSpan = document.createElement('span');
                    adminSpan.textContent = '管理';
                    adminSpan.classList.add('admin-badge');
                    nameSpan.appendChild(adminSpan);
                }
                if (user.isVip) {
                    const vipSpan = document.createElement('span');
                    vipSpan.textContent = 'VIP';
                    vipSpan.classList.add('vip-badge');
                    nameSpan.appendChild(vipSpan);
                }
                userDiv.appendChild(avatarImg);
                userDiv.appendChild(nameSpan);
                userTd.appendChild(userDiv);
                tr.appendChild(userTd);
                
                // 注册日期
                const dateTd = document.createElement('td');
                dateTd.textContent = new Date(user.createdAt).toLocaleDateString();
                tr.appendChild(dateTd);
                
                // 最高分
                const scoreTd = document.createElement('td');
                scoreTd.textContent = user.highscore;
                tr.appendChild(scoreTd);
                
                // 状态
                const statusTd = document.createElement('td');
                statusTd.textContent = '正常';
                tr.appendChild(statusTd);
                
                // 操作
                const actionsTd = document.createElement('td');
                const actionsDiv = document.createElement('div');
                actionsDiv.classList.add('admin-actions');
                
                // 设为管理员按钮
                const adminBtn = document.createElement('button');
                adminBtn.textContent = user.isAdmin ? '取消管理' : '设为管理';
                adminBtn.classList.add('admin-btn');
                adminBtn.classList.add(user.isAdmin ? 'danger' : 'primary');
                adminBtn.addEventListener('click', () => toggleAdmin(user.id));
                actionsDiv.appendChild(adminBtn);
                
                // 封禁按钮
                const banBtn = document.createElement('button');
                banBtn.textContent = '封禁';
                banBtn.classList.add('admin-btn');
                banBtn.classList.add('danger');
                banBtn.addEventListener('click', () => banUser(user.id));
                actionsDiv.appendChild(banBtn);
                
                // 赠送物品按钮
                const giftBtn = document.createElement('button');
                giftBtn.textContent = '赠送';
                giftBtn.classList.add('admin-btn');
                giftBtn.classList.add('success');
                giftBtn.addEventListener('click', () => giftItems(user.id));
                actionsDiv.appendChild(giftBtn);
                
                actionsTd.appendChild(actionsDiv);
                tr.appendChild(actionsTd);
                
                elements.adminUsersTable.appendChild(tr);
            });
        }

        // 切换管理员状态
        function toggleAdmin(userId) {
            const user = gameState.users.find(u => u.id === userId);
            if (user) {
                user.isAdmin = !user.isAdmin;
                saveGameData();
                updateAdminUsersTable();
                
                // 如果修改的是当前用户，更新UI
                if (user.id === gameState.currentUser.id) {
                    gameState.isAdmin = user.isAdmin;
                    updateUserUI();
                }
                
                showMessage('成功', `已${user.isAdmin ? '授予' : '取消'}管理员权限`);
            }
        }

        // 封禁用户
        function banUser(userId) {
            showConfirm('确认封禁', '确定要封禁此用户吗？', () => {
                const user = gameState.users.find(u => u.id === userId);
                if (user) {
                    // 在实际应用中，这里应该标记用户为封禁状态
                    showMessage('成功', `用户 ${user.nickname || user.username} 已被封禁`);
                }
            });
        }

        // 赠送物品
        function giftItems(userId) {
            const user = gameState.users.find(u => u.id === userId);
            if (!user) return;
            
            // 显示赠送物品表单
            elements.adminActionModalTitle.textContent = `赠送物品给 ${user.nickname || user.username}`;
            elements.adminActionFormGroup.innerHTML = `
                <label for="giftType">物品类型</label>
                <select id="giftType" class="form-control">
                    <option value="coins">金币</option>
                    <option value="keys">钥匙</option>
                    <option value="lives">生命</option>
                </select>
                <label for="giftAmount" class="mt-10">数量</label>
                <input type="number" id="giftAmount" class="form-control" value="100" min="1">
            `;
            
            // 设置确认回调
            elements.adminActionModalConfirmBtn.onclick = () => {
                const type = document.getElementById('giftType').value;
                const amount = parseInt(document.getElementById('giftAmount').value);
                
                if (isNaN(amount) || amount < 1) {
                    showMessage('错误', '请输入有效的数量');
                    return;
                }
                
                if (type === 'coins') {
                    user.coins += amount;
                } else if (type === 'keys') {
                    user.keys += amount;
                } else if (type === 'lives') {
                    user.lives += amount;
                }
                
                saveGameData();
                updateAdminUsersTable();
                
                // 如果修改的是当前用户，更新UI
                if (user.id === gameState.currentUser.id) {
                    updateUserUI();
                }
                
                hideModal('adminActionModal');
                showMessage('成功', `已赠送 ${amount} ${type === 'coins' ? '金币' : type === 'keys' ? '钥匙' : '生命'}给 ${user.nickname || user.username}`);
            };
            
            showModal('adminActionModal');
        }

        // 显示开发者模式
        function showDevMode() {
            hideAllContent();
            elements.devContainer.style.display = 'block';
            
            // 更新开发者用户表格
            updateDevUsersTable();
        }

        // 更新开发者用户表格
        function updateDevUsersTable() {
            elements.devUsersTable.innerHTML = '';
            
            gameState.users.forEach(user => {
                const tr = document.createElement('tr');
                
                // 用户名和头像
                const userTd = document.createElement('td');
                const userDiv = document.createElement('div');
                userDiv.classList.add('admin-user');
                const avatarImg = document.createElement('img');
                avatarImg.src = `images/avatars/${user.avatar}.png`;
                avatarImg.classList.add('admin-avatar');
                const nameSpan = document.createElement('span');
                nameSpan.textContent = user.nickname || user.username;
                if (user.isAdmin) {
                    const adminSpan = document.createElement('span');
                    adminSpan.textContent = '管理';
                    adminSpan.classList.add('admin-badge');
                    nameSpan.appendChild(adminSpan);
                }
                if (user.isVip) {
                    const vipSpan = document.createElement('span');
                    vipSpan.textContent = 'VIP';
                    vipSpan.classList.add('vip-badge');
                    nameSpan.appendChild(vipSpan);
                }
                userDiv.appendChild(avatarImg);
                userDiv.appendChild(nameSpan);
                userTd.appendChild(userDiv);
                tr.appendChild(userTd);
                
                // 注册日期
                const dateTd = document.createElement('td');
                dateTd.textContent = new Date(user.createdAt).toLocaleDateString();
                tr.appendChild(dateTd);
                
                // 状态
                const statusTd = document.createElement('td');
                statusTd.textContent = '正常';
                tr.appendChild(statusTd);
                
                // 操作
                const actionsTd = document.createElement('td');
                const actionsDiv = document.createElement('div');
                actionsDiv.classList.add('admin-actions');
                
                // 收回账户按钮
                const reclaimBtn = document.createElement('button');
                reclaimBtn.textContent = '收回';
                reclaimBtn.classList.add('admin-btn');
                reclaimBtn.classList.add('danger');
                reclaimBtn.addEventListener('click', () => reclaimAccount(user.id));
                actionsDiv.appendChild(reclaimBtn);
                
                actionsTd.appendChild(actionsDiv);
                tr.appendChild(actionsTd);
                
                elements.devUsersTable.appendChild(tr);
            });
        }

        // 收回账户
        function reclaimAccount(userId) {
            showConfirm('确认收回', '确定要收回此账户吗？密码将重置为默认密码。', () => {
                const user = gameState.users.find(u => u.id === userId);
                if (user) {
                    user.password = '19996837879gxhbsh';
                    saveGameData();
                    updateDevUsersTable();
                    showMessage('成功', `账户 ${user.nickname || user.username} 已收回，密码已重置`);
                }
            });
        }

        // 预览更新
        function previewUpdate() {
            const code = elements.devCodeEditor.value;
            if (!code) {
                showMessage('错误', '请输入HTML代码');
                return;
            }
            
            // 在新窗口中预览
            const previewWindow = window.open('', '_blank');
            previewWindow.document.write(code);
            previewWindow.document.close();
        }

        // 发布更新
        function publishUpdate() {
            showConfirm('确认发布', '确定要发布更新吗？这将覆盖当前网站。', () => {
                // 在实际应用中，这里应该将代码保存到服务器
                showMessage('成功', '更新已发布');
            });
        }

        // 清除所有数据
        function clearAllData() {
            showConfirm('确认清除', '确定要清除所有数据吗？此操作不可逆！', () => {
                localStorage.removeItem('bombDodgeGameData');
                initDefaultData();
                showMessage('成功', '所有数据已清除并重置为默认值');
            });
        }

        // 重置游戏数据
        function resetGameData() {
            showConfirm('确认重置', '确定要重置游戏数据吗？这将重置所有用户的游戏进度。', () => {
                gameState.users.forEach(user => {
                    user.coins = 50;
                    user.keys = 1;
                    user.highscore = 0;
                    user.lives = 3;
                    user.isVip = false;
                });
                
                gameState.leaderboard = [];
                saveGameData();
                
                // 更新当前用户UI
                if (gameState.currentUser) {
                    updateUserUI();
                }
                
                showMessage('成功', '游戏数据已重置');
            });
        }

        // 迁移数据
        function migrateData() {
            showConfirm('确认迁移', '确定要迁移数据吗？', () => {
                // 在实际应用中，这里应该执行数据迁移逻辑
                showMessage('成功', '数据迁移完成');
            });
        }

        // 注销用户
        function logoutUser() {
            toggleDropdown();
            
            showConfirm('确认退出', '确定要退出登录吗？', () => {
                gameState.currentUser = null;
                gameState.isAdmin = false;
                gameState.isDev = false;
                gameState.isVip = false;
                
                // 切换到登录界面
                elements.mainContainer.style.display = 'none';
                elements.authContainer.style.display = 'flex';
                
                // 清空登录表单
                elements.loginUsername.value = '';
                elements.loginPassword.value = '';
            });
        }

        // 显示主页
        function showHome() {
            hideAllContent();
            elements.homeContent.style.display = 'block';
        }

        // 开始游戏
        function startGame() {
            // 重置游戏状态
            gameState.isPlaying = true;
            gameState.isPaused = false;
            gameState.score = 0;
            gameState.coins = 0;
            gameState.keys = gameState.currentUser.keys;
            gameState.lives = gameState.currentUser.lives;
            gameState.speed = config.initialSpeed;
            gameState.level = 1;
            gameState.bombs = [];
            gameState.items = [];
            gameState.lastBombSpawn = 0;
            gameState.lastItemSpawn = 0;
            gameState.keysPressed = {};
            gameState.playerX = config.gameWidth / 2 - config.playerSize / 2;
            gameState.playerY = config.gameHeight - config.playerSize - 20;
            
            // 更新UI
            elements.gameCoins.textContent = gameState.coins;
            elements.gameKeys.textContent = gameState.keys;
            elements.gameLives.textContent = gameState.lives;
            elements.gameScore.textContent = gameState.score;
            
            // 隐藏游戏结束界面
            elements.gameOver.style.display = 'none';
            
            // 切换到游戏界面
            hideAllContent();
            elements.gameContainer.style.display = 'block';
            
            // 开始游戏循环
            if (gameState.gameInterval) {
                clearInterval(gameState.gameInterval);
            }
            
            if (gameState.animationFrame) {
                cancelAnimationFrame(gameState.animationFrame);
            }
            
            gameState.gameInterval = setInterval(updateGame, 16);
            gameState.animationFrame = requestAnimationFrame(drawGame);
        }

        // 更新游戏状态
        function updateGame() {
            if (gameState.isPaused || !gameState.isPlaying) return;
            
            // 移动玩家
            if (gameState.keysPressed.ArrowLeft && gameState.playerX > 0) {
                gameState.playerX -= gameState.speed * 2;
            }
            if (gameState.keysPressed.ArrowRight && gameState.playerX < config.gameWidth - config.playerSize) {
                gameState.playerX += gameState.speed * 2;
            }
            if (gameState.keysPressed.ArrowUp && gameState.playerY > 0) {
                gameState.playerY -= gameState.speed * 2;
            }
            if (gameState.keysPressed.ArrowDown && gameState.playerY < config.gameHeight - config.playerSize) {
                gameState.playerY += gameState.speed * 2;
            }
            
            // 生成炸弹
            if (Date.now() - gameState.lastBombSpawn > config.bombSpawnRate / gameState.speed * 100) {
                spawnBomb();
                gameState.lastBombSpawn = Date.now();
            }
            
            // 生成物品
            if (Date.now() - gameState.lastItemSpawn > config.itemSpawnRate / gameState.speed * 100) {
                spawnItem();
                gameState.lastItemSpawn = Date.now();
            }
            
            // 更新炸弹位置
            for (let i = gameState.bombs.length - 1; i >= 0; i--) {
                gameState.bombs[i].y += gameState.speed;
                
                // 检查炸弹是否超出屏幕
                if (gameState.bombs[i].y > config.gameHeight) {
                    gameState.bombs.splice(i, 1);
                    continue;
                }
                
                // 检查碰撞
                if (checkCollision(
                    gameState.playerX, gameState.playerY, config.playerSize, config.playerSize,
                    gameState.bombs[i].x, gameState.bombs[i].y, config.bombSize, config.bombSize
                )) {
                    handleBombCollision(i);
                    break;
                }
            }
            
            // 更新物品位置
            for (let i = gameState.items.length - 1; i >= 0; i--) {
                gameState.items[i].y += gameState.speed;
                
                // 检查物品是否超出屏幕
                if (gameState.items[i].y > config.gameHeight) {
                    gameState.items.splice(i, 1);
                    continue;
                }
                
                // 检查碰撞
                if (checkCollision(
                    gameState.playerX, gameState.playerY, config.playerSize, config.playerSize,
                    gameState.items[i].x, gameState.items[i].y, config.itemSize, config.itemSize
                )) {
                    handleItemCollision(i);
                    break;
                }
            }
            
            // 增加分数
            gameState.score += Math.floor(gameState.speed);
            elements.gameScore.textContent = gameState.score;
            
            // 增加速度
            if (gameState.score % 500 === 0) {
                gameState.speed = Math.min(config.maxSpeed, gameState.speed + config.speedIncrement);
                gameState.level = Math.floor(gameState.speed / config.speedIncrement) + 1;
            }
        }

        // 绘制游戏
        function drawGame() {
            if (!gameState.isPlaying) return;
            
            const ctx = elements.gameCanvas.getContext('2d');
            
            // 清空画布
            ctx.clearRect(0, 0, config.gameWidth, config.gameHeight);
            
            // 绘制背景
            ctx.fillStyle = '#e0e5ec';
            ctx.fillRect(0, 0, config.gameWidth, config.gameHeight);
            
            // 绘制玩家
            // 在实际应用中，这里应该使用玩家的皮肤图片
            ctx.fillStyle = '#4a6bff';
            ctx.fillRect(gameState.playerX, gameState.playerY, config.playerSize, config.playerSize);
            
            // 绘制炸弹
            ctx.fillStyle = '#2c3e50';
            gameState.bombs.forEach(bomb => {
                // 在实际应用中，这里应该使用炸弹的图片
                ctx.fillRect(bomb.x, bomb.y, config.bombSize, config.bombSize);
            });
            
            // 绘制物品
            gameState.items.forEach(item => {
                switch (item.type) {
                    case 'coin':
                        ctx.fillStyle = '#feca57'; // 金币颜色
                        break;
                    case 'key':
                        ctx.fillStyle = '#1dd1a1'; // 钥匙颜色
                        break;
                    case 'life':
                        ctx.fillStyle = '#ff6b6b'; // 生命颜色
                        break;
                    case 'speedUp':
                        ctx.fillStyle = '#54a0ff'; // 加速颜色
                        break;
                    case 'speedDown':
                        ctx.fillStyle = '#5f27cd'; // 减速颜色
                        break;
                }
                // 在实际应用中，这里应该使用物品的图片
                ctx.fillRect(item.x, item.y, config.itemSize, config.itemSize);
            });
            
            // 绘制暂停界面
            if (gameState.isPaused) {
                ctx.fillStyle = 'rgba(0, 0, 0, 0.7)';
                ctx.fillRect(0, 0, config.gameWidth, config.gameHeight);
                
                ctx.fillStyle = 'white';
                ctx.font = '30px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('游戏暂停', config.gameWidth / 2, config.gameHeight / 2);
                ctx.font = '20px Arial';
                ctx.fillText('点击继续', config.gameWidth / 2, config.gameHeight / 2 + 40);
            }
            
            gameState.animationFrame = requestAnimationFrame(drawGame);
        }

        // 生成炸弹
        function spawnBomb() {
            const x = Math.random() * (config.gameWidth - config.bombSize);
            const y = -config.bombSize;
            
            gameState.bombs.push({ x, y });
        }

        // 生成物品
        function spawnItem() {
            const x = Math.random() * (config.gameWidth - config.itemSize);
            const y = -config.itemSize;
            
            // 随机选择物品类型
            const types = ['coin', 'key', 'life', 'speedUp', 'speedDown'];
            const weights = [0.5, 0.2, 0.1, 0.1, 0.1]; // 权重
            const random = Math.random();
            let type = 'coin';
            
            let cumulativeWeight = 0;
            for (let i = 0; i < types.length; i++) {
                cumulativeWeight += weights[i];
                if (random < cumulativeWeight) {
                    type = types[i];
                    break;
                }
            }
            
            gameState.items.push({ x, y, type });
        }

        // 检查碰撞
        function checkCollision(x1, y1, w1, h1, x2, y2, w2, h2) {
            return x1 < x2 + w2 &&
                   x1 + w1 > x2 &&
                   y1 < y2 + h2 &&
                   y1 + h1 > y2;
        }

        // 处理炸弹碰撞
        function handleBombCollision(bombIndex) {
            gameState.bombs.splice(bombIndex, 1);
            
            // 检查是否有生命或钥匙
            if (gameState.lives > 1) {
                // 使用生命
                gameState.lives--;
                elements.gameLives.textContent = gameState.lives;
                
                // 显示碰撞效果
                showCollisionEffect();
            } else if (gameState.keys > 0) {
                // 询问是否使用钥匙
                elements.modalKeyCount.textContent = gameState.keys;
                showModal('keyModal');
            } else {
                // 游戏结束
                gameOver();
            }
        }

        // 使用钥匙继续游戏
        function useKeyToContinue() {
            gameState.keys--;
            elements.gameKeys.textContent = gameState.keys;
            hideModal('keyModal');
            
            // 显示碰撞效果
            showCollisionEffect();
        }

        // 显示碰撞效果
        function showCollisionEffect() {
            // 在实际应用中，这里可以添加碰撞动画或音效
            elements.gameCanvas.classList.add('shake');
            setTimeout(() => {
                elements.gameCanvas.classList.remove('shake');
            }, 500);
        }

        // 处理物品碰撞
        function handleItemCollision(itemIndex) {
            const item = gameState.items[itemIndex];
            
            switch (item.type) {
                case 'coin':
                    gameState.coins += 5;
                    elements.gameCoins.textContent = gameState.coins;
                    break;
                case 'key':
                    gameState.keys++;
                    elements.gameKeys.textContent = gameState.keys;
                    break;
                case 'life':
                    gameState.lives++;
                    elements.gameLives.textContent = gameState.lives;
                    break;
                case 'speedUp':
                    gameState.speed = Math.min(config.maxSpeed, gameState.speed + 0.5);
                    break;
                case 'speedDown':
                    gameState.speed = Math.max(config.initialSpeed, gameState.speed - 0.5);
                    break;
            }
            
            gameState.items.splice(itemIndex, 1);
            
            // 显示收集效果
            showCollectEffect(item.type);
        }

        // 显示收集效果
        function showCollectEffect(type) {
            // 在实际应用中，这里可以添加收集动画或音效
            let color = '#feca57';
            switch (type) {
                case 'key': color = '#1dd1a1'; break;
                case 'life': color = '#ff6b6b'; break;
                case 'speedUp': color = '#54a0ff'; break;
                case 'speedDown': color = '#5f27cd'; break;
            }
            
            const effect = document.createElement('div');
            effect.style.position = 'absolute';
            effect.style.left = `${gameState.playerX}px`;
            effect.style.top = `${gameState.playerY}px`;
            effect.style.width = `${config.playerSize}px`;
            effect.style.height = `${config.playerSize}px`;
            effect.style.backgroundColor = color;
            effect.style.opacity = '0.7';
            effect.style.borderRadius = '50%';
            effect.style.pointerEvents = 'none';
            effect.style.transform = 'scale(1)';
            effect.style.transition = 'all 0.5s ease';
            
            elements.gameContainer.appendChild(effect);
            
            setTimeout(() => {
                effect.style.transform = 'scale(2)';
                effect.style.opacity = '0';
            }, 10);
            
            setTimeout(() => {
                elements.gameContainer.removeChild(effect);
            }, 510);
        }

        // 游戏结束
        function gameOver() {
            gameState.isPlaying = false;
            
            // 清除游戏循环
            clearInterval(gameState.gameInterval);
            cancelAnimationFrame(gameState.animationFrame);
            
            // 更新用户数据
            const user = gameState.currentUser;
            const isNewHighscore = gameState.score > user.highscore;
            
            if (isNewHighscore) {
                user.highscore = gameState.score;
                elements.newHighscore.classList.remove('hidden');
            } else {
                elements.newHighscore.classList.add('hidden');
            }
            
            user.coins += gameState.coins;
            user.keys = gameState.keys;
            user.lives = Math.min(3, user.lives + 1); // 恢复一个生命，最多3个
            
            // 添加到排行榜
            gameState.leaderboard.push({
                userId: user.id,
                username: user.username,
                nickname: user.nickname,
                avatar: user.avatar,
                score: gameState.score,
                date: new Date().toISOString()
            });
            
            // 保存数据
            saveGameData();
            
            // 更新游戏结束界面
            elements.finalScore.textContent = gameState.score;
            elements.finalCoins.textContent = gameState.coins;
            elements.finalKeys.textContent = gameState.keys;
            elements.finalHighscore.textContent = user.highscore;
            
            // 计算排名
            const sortedLeaderboard = [...gameState.leaderboard].sort((a, b) => b.score - a.score);
            const rank = sortedLeaderboard.findIndex(entry => entry.userId === user.id) + 1;
            elements.finalRank.textContent = `#${rank}`;
            
            // 显示游戏结束界面
            elements.gameOver.style.display = 'flex';
        }

        // 返回主页
        function backToHome() {
            // 更新用户UI
            updateUserUI();
            
            // 切换到主页
            hideAllContent();
            elements.homeContent.style.display = 'block';
        }

        // 切换暂停状态
        function togglePause() {
            gameState.isPaused = !gameState.isPaused;
        }

        // 处理按键按下
        function handleKeyDown(e) {
            if (!gameState.isPlaying || gameState.isPaused) return;
            
            if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown', 'Space'].includes(e.code)) {
                gameState.keysPressed[e.code] = true;
                e.preventDefault();
            }
            
            // 空格键暂停
            if (e.code === 'Space') {
                togglePause();
            }
        }

        // 处理按键释放
        function handleKeyUp(e) {
            if (['ArrowLeft', 'ArrowRight', 'ArrowUp', 'ArrowDown'].includes(e.code)) {
                gameState.keysPressed[e.code] = false;
                e.preventDefault();
            }
        }

        // 显示商店
        function showShop() {
            hideAllContent();
            elements.shopContainer.style.display = 'block';
            
            // 更新商店物品
            updateShopItems();
        }

        // 更新商店物品
        function updateShopItems() {
            if (!gameState.currentUser) return;
            
            // 更新皮肤
            updateShopCategory('skins');
            
            // 更新头像
            updateShopCategory('avatars');
            
            // 更新道具
            updateShopCategory('powerups');
        }

        // 更新商店分类
        function updateShopCategory(category) {
            const container = elements[`${category}Items`];
            container.innerHTML = '';
            
            gameState.shopItems[category].forEach(item => {
                // 检查VIP物品是否可见
                if (item.vip && !gameState.currentUser.isVip && !gameState.currentUser.isDev) {
                    return;
                }
                
                const shopItem = document.createElement('div');
                shopItem.classList.add('shop-item');
                
                // 物品图片
                const itemImg = document.createElement('div');
                itemImg.classList.add('shop-item-img');
                
                // 在实际应用中，这里应该使用物品的图片
                const img = document.createElement('div');
                img.style.width = '100%';
                img.style.height = '100%';
                img.style.display = 'flex';
                img.style.alignItems = 'center';
                img.style.justifyContent = 'center';
                img.style.fontSize = '40px';
                
                // 根据类型设置不同的显示
                if (category === 'skins') {
                    img.style.backgroundColor = getSkinColor(item.id);
                } else if (category === 'avatars') {
                    // 在实际应用中，这里应该使用头像图片
                    img.textContent = '👤';
                } else {
                    // 道具
                    switch (item.id) {
                        case 'life': img.textContent = '❤️'; break;
                        case 'key': img.textContent = '🔑'; break;
                        case 'speed': img.textContent = '⚡'; break;
                        case 'vip_life': img.textContent = '💎'; break;
                    }
                }
                
                itemImg.appendChild(img);
                
                // VIP徽章
                if (item.vip) {
                    const vipBadge = document.createElement('div');
                    vipBadge.classList.add('shop-item-badge');
                    vipBadge.textContent = 'VIP';
                    itemImg.appendChild(vipBadge);
                }
                
                shopItem.appendChild(itemImg);
                
                // 物品信息
                const itemInfo = document.createElement('div');
                itemInfo.classList.add('shop-item-info');
                
                const itemName = document.createElement('h3');
                itemName.textContent = item.name;
                itemInfo.appendChild(itemName);
                
                const itemDesc = document.createElement('p');
                itemDesc.textContent = getItemDescription(item.id, category);
                itemInfo.appendChild(itemDesc);
                
                // 物品底部
                const itemFooter = document.createElement('div');
                itemFooter.classList.add('shop-item-footer');
                
                const itemPrice = document.createElement('div');
                itemPrice.classList.add('shop-item-price');
                
                // 开发者无限金币
                const price = gameState.currentUser.isDev ? 0 : item.price;
                
                const priceIcon = document.createElement('i');
                priceIcon.classList.add('fas', 'fa-coins');
                itemPrice.appendChild(priceIcon);
                itemPrice.appendChild(document.createTextNode(` ${price}`));
                itemFooter.appendChild(itemPrice);
                
                const itemBtn = document.createElement('button');
                itemBtn.classList.add('shop-item-btn');
                
                if (item.owned) {
                    if (item.equipped) {
                        itemBtn.textContent = '已装备';
                        itemBtn.classList.add('equipped');
                    } else {
                        itemBtn.textContent = '装备';
                        itemBtn.addEventListener('click', () => equipItem(item.id, category));
                    }
                } else {
                    itemBtn.textContent = '购买';
                    if (gameState.currentUser.coins >= price || gameState.currentUser.isDev) {
                        itemBtn.addEventListener('click', () => buyItem(item.id, category));
                    } else {
                        itemBtn.disabled = true;
                        itemBtn.style.opacity = '0.5';
                    }
                }
                
                itemFooter.appendChild(itemBtn);
                itemInfo.appendChild(itemFooter);
                shopItem.appendChild(itemInfo);
                container.appendChild(shopItem);
            });
        }

        // 获取皮肤颜色
        function getSkinColor(skinId) {
            switch (skinId) {
                case 'red': return '#ff6b6b';
                case 'blue': return '#4a6bff';
                case 'green': return '#1dd1a1';
                case 'gold': return '#feca57';
                case 'vip1': return '#5f27cd';
                case 'vip2': return '#ff9ff3';
                default: return '#2c3e50'; // 默认皮肤
            }
        }

        // 获取物品描述
        function getItemDescription(itemId, category) {
            if (category === 'skins') {
                return '游戏中的玩家外观';
            } else if (category === 'avatars') {
                return '个人资料和排行榜中的头像';
            } else {
                switch (itemId) {
                    case 'life': return '增加一个生命值';
                    case 'key': return '可以用来解锁特殊物品或继续游戏';
                    case 'speed': return '暂时提升移动速度';
                    case 'vip_life': return 'VIP专属生命值';
                    default: return '游戏道具';
                }
            }
        }

        // 购买物品
        function buyItem(itemId, category) {
            const user = gameState.currentUser;
            const items = gameState.shopItems[category];
            const item = items.find(i => i.id === itemId);
            
            if (!item) return;
            
            // 开发者无限金币
            const price = user.isDev ? 0 : item.price;
            
            if (user.coins >= price) {
                user.coins -= price;
                item.owned = true;
                
                // 如果是皮肤或头像，自动装备
                if (category === 'skins' || category === 'avatars') {
                    equipItem(itemId, category);
                }
                
                // 保存数据
                saveGameData();
                
                // 更新UI
                updateUserUI();
                updateShopItems();
                
                showMessage('成功', `已购买 ${item.name}`);
            } else {
                showMessage('错误', '金币不足');
            }
        }

        // 装备物品
        function equipItem(itemId, category) {
            const items = gameState.shopItems[category];
            
            // 取消装备所有同类型物品
            items.forEach(item => {
                item.equipped = false;
            });
            
            // 装备当前物品
            const item = items.find(i => i.id === itemId);
            if (item) {
                item.equipped = true;
                
                // 如果是皮肤，更新游戏中的皮肤
                if (category === 'skins') {
                    gameState.playerSkin = itemId;
                }
                
                // 如果是头像，更新用户头像
                if (category === 'avatars') {
                    gameState.currentUser.avatar = itemId;
                    updateAvatar(itemId);
                }
                
                // 保存数据
                saveGameData();
                
                // 更新UI
                updateShopItems();
                
                showMessage('成功', `已装备 ${item.name}`);
            }
        }

        // 购买VIP
        function buyVip(type) {
            const user = gameState.currentUser;
            const price = type === 'monthly' ? 200 : 1000;
            
            if (user.coins >= price) {
                user.coins -= price;
                user.isVip = true;
                gameState.isVip = true;
                
                // 设置VIP过期时间
                const now = new Date();
                const expiryDate = new Date(now);
                expiryDate.setDate(now.getDate() + (type === 'monthly' ? 30 : 365));
                user.vipExpiry = expiryDate.toISOString();
                
                // 保存数据
                saveGameData();
                
                // 更新UI
                updateUserUI();
                updateShopItems();
                
                showMessage('成功', `已成功购买${type === 'monthly' ? '包月' : '包年'}VIP会员`);
            } else {
                showMessage('错误', '金币不足');
            }
        }

        // 显示排行榜
        function showLeaderboard() {
            hideAllContent();
            elements.leaderboardContainer.style.display = 'block';
            
            // 更新排行榜
            updateLeaderboard();
        }

        // 更新排行榜
        function updateLeaderboard() {
            if (!gameState.currentUser) return;
            
            // 更新全球排行榜
            updateLeaderboardTable('global');
            
            // 更新好友排行榜 (简化版，实际应用中应该有好友系统)
            updateLeaderboardTable('friends');
            
            // 更新今日排行榜
            updateLeaderboardTable('today');
        }

        // 更新排行榜表格
        function updateLeaderboardTable(type) {
            const tbody = elements[`${type}Leaderboard`];
            tbody.innerHTML = '';
            
            // 获取排行榜数据
            let data = [];
            if (type === 'global') {
                data = [...gameState.leaderboard].sort((a, b) => b.score - a.score).slice(0, 100);
            } else if (type === 'friends') {
                // 简化版，显示前100名
                data = [...gameState.leaderboard].sort((a, b) => b.score - a.score).slice(0, 100);
            } else if (type === 'today') {
                const today = new Date().toISOString().split('T')[0];
                data = gameState.leaderboard
                    .filter(entry => entry.date.startsWith(today))
                    .sort((a, b) => b.score - a.score)
                    .slice(0, 100);
            }
            
            // 添加行
            data.forEach((entry, index) => {
                const tr = document.createElement('tr');
                if (entry.userId === gameState.currentUser.id) {
                    tr.classList.add('leaderboard-you');
                }
                
                // 排名
                const rankTd = document.createElement('td');
                rankTd.classList.add('leaderboard-rank');
                rankTd.textContent = `#${index + 1}`;
                tr.appendChild(rankTd);
                
                // 用户
                const userTd = document.createElement('td');
                const userDiv = document.createElement('div');
                userDiv.classList.add('leaderboard-user');
                
                // 在实际应用中，这里应该使用头像图片
                const avatarImg = document.createElement('img');
                avatarImg.src = `images/avatars/${entry.avatar || 'default'}.png`;
                avatarImg.classList.add('leaderboard-avatar');
                userDiv.appendChild(avatarImg);
                
                const nameSpan = document.createElement('span');
                nameSpan.classList.add('leaderboard-name');
                nameSpan.textContent = entry.nickname || entry.username;
                userDiv.appendChild(nameSpan);
                
                userTd.appendChild(userDiv);
                tr.appendChild(userTd);
                
                // 分数
                const scoreTd = document.createElement('td');
                scoreTd.classList.add('leaderboard-score');
                scoreTd.textContent = entry.score;
                tr.appendChild(scoreTd);
                
                // 日期/时间
                const dateTd = document.createElement('td');
                if (type === 'today') {
                    const date = new Date(entry.date);
                    dateTd.textContent = date.toLocaleTimeString();
                } else {
                    const date = new Date(entry.date);
                    dateTd.textContent = date.toLocaleDateString();
                }
                tr.appendChild(dateTd);
                
                tbody.appendChild(tr);
            });
        }

        // 切换商店标签
        function switchShopTab(tab) {
            document.querySelectorAll('.shop-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            document.querySelectorAll('.shop-content').forEach(c => {
                c.classList.toggle('active', c.dataset.content === tab);
            });
        }

        // 切换排行榜标签
        function switchLeaderboardTab(tab) {
            document.querySelectorAll('.leaderboard-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            document.querySelectorAll('.leaderboard-content').forEach(c => {
                c.classList.toggle('active', c.dataset.content === tab);
            });
        }

        // 切换管理员标签
        function switchAdminTab(tab) {
            document.querySelectorAll('.admin-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            document.querySelectorAll('.admin-content').forEach(c => {
                c.classList.toggle('active', c.dataset.content === tab);
            });
        }

        // 保存个人资料
        function saveProfile() {
            const nickname = elements.nickname.value.trim();
            
            if (!nickname) {
                showMessage('错误', '请输入昵称');
                return;
            }
            
            gameState.currentUser.nickname = nickname;
            saveGameData();
            updateUserUI();
            
            showMessage('成功', '个人资料已保存');
        }

        // 保存设置
        function saveSettings() {
            config.controls = elements.controls.value;
            config.soundVolume = parseInt(elements.soundVolume.value);
            config.musicVolume = parseInt(elements.musicVolume.value);
            
            showMessage('成功', '设置已保存');
        }

        // 更改密码
        function changePassword() {
            const currentPassword = elements.currentPassword.value.trim();
            const newPassword = elements.newPassword.value.trim();
            const confirmNewPassword = elements.confirmNewPassword.value.trim();
            
            if (!currentPassword || !newPassword || !confirmNewPassword) {
                showMessage('错误', '请填写所有字段');
                return;
            }
            
            if (currentPassword !== gameState.currentUser.password) {
                showMessage('错误', '当前密码不正确');
                return;
            }
            
            if (newPassword !== confirmNewPassword) {
                showMessage('错误', '两次输入的新密码不一致');
                return;
            }
            
            if (newPassword.length < 6) {
                showMessage('错误', '新密码长度应至少为6个字符');
                return;
            }
            
            gameState.currentUser.password = newPassword;
            saveGameData();
            
            // 清空密码字段
            elements.currentPassword.value = '';
            elements.newPassword.value = '';
            elements.confirmNewPassword.value = '';
            
            showMessage('成功', '密码已更改');
        }

        // 隐藏所有内容
        function hideAllContent() {
            elements.homeContent.style.display = 'none';
            elements.gameContainer.style.display = 'none';
            elements.shopContainer.style.display = 'none';
            elements.leaderboardContainer.style.display = 'none';
            elements.settingsContainer.style.display = 'none';
            elements.adminContainer.style.display = 'none';
            elements.devContainer.style.display = 'none';
        }

        // 显示模态框
        function showModal(id) {
            elements[id].style.display = 'flex';
        }

        // 隐藏模态框
        function hideModal(id) {
            elements[id].style.display = 'none';
        }

        // 显示确认对话框
        function showConfirm(title, message, callback) {
            elements.confirmModalTitle.textContent = title;
            elements.confirmModalMessage.textContent = message;
            
            // 设置确认回调
            elements.confirmModalYesBtn.onclick = () => {
                hideModal('confirmModal');
                callback();
            };
            
            showModal('confirmModal');
        }

        // 确认操作
        function confirmAction() {
            // 在实际应用中，这里应该执行确认后的操作
            hideModal('confirmModal');
        }

        // 确认管理员操作
        function confirmAdminAction() {
            // 在实际应用中，这里应该执行管理员操作
            hideModal('adminActionModal');
        }

        // 显示消息
        function showMessage(title, message) {
            elements.messageModalTitle.textContent = title;
            elements.messageModalMessage.textContent = message;
            showModal('messageModal');
        }

        // 初始化游戏
        initGame();
    </script>
</body>
</html>
