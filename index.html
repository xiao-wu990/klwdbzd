<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>炸弹躲避大冒险</title>
    <style>
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --danger-color: #f44336;
            --success-color: #4caf50;
            --warning-color: #ff9800;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        body {
            background-color: #f0f2f5;
            color: var(--dark-color);
            overflow-x: hidden;
        }

        /* 登录/注册界面 */
        .auth-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
        }

        .auth-box {
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            width: 100%;
            max-width: 400px;
            padding: 30px;
            text-align: center;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-title {
            font-size: 24px;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        .auth-form .form-group {
            margin-bottom: 20px;
            text-align: left;
        }

        .auth-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        .auth-form input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }

        .auth-form input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        .auth-btn {
            width: 100%;
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s;
            margin-top: 10px;
        }

        .auth-btn:hover {
            background-color: var(--secondary-color);
        }

        .auth-switch {
            margin-top: 20px;
            font-size: 14px;
        }

        .auth-switch a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 600;
        }

        .auth-switch a:hover {
            text-decoration: underline;
        }

        .remember-me {
            display: flex;
            align-items: center;
            margin-top: 10px;
        }

        .remember-me input {
            width: auto;
            margin-right: 10px;
        }

        /* 主界面 */
        .main-container {
            display: none;
            flex-direction: column;
            min-height: 100vh;
            background-color: #f0f2f5;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid white;
            cursor: pointer;
        }

        .username {
            font-weight: 600;
            cursor: pointer;
        }

        .menu-btn {
            background: none;
            border: none;
            color: white;
            font-size: 20px;
            cursor: pointer;
        }

        /* 侧边菜单 */
        .sidebar {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100%;
            background-color: white;
            box-shadow: -5px 0 15px rgba(0, 0, 0, 0.1);
            transition: right 0.3s ease;
            z-index: 1000;
            padding: 20px;
            overflow-y: auto;
        }

        .sidebar.open {
            right: 0;
        }

        .sidebar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #eee;
        }

        .sidebar-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--dark-color);
        }

        .sidebar-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .menu-item:hover {
            background-color: #f5f5f5;
        }

        .menu-icon {
            margin-right: 10px;
            font-size: 18px;
            color: var(--primary-color);
        }

        .menu-text {
            font-size: 14px;
        }

        .badge {
            background-color: var(--accent-color);
            color: white;
            border-radius: 10px;
            padding: 2px 8px;
            font-size: 12px;
            margin-left: auto;
        }

        /* 游戏主页 */
        .home-container {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .welcome-message {
            text-align: center;
            margin-bottom: 30px;
        }

        .welcome-title {
            font-size: 28px;
            margin-bottom: 10px;
            color: var(--primary-color);
        }

        .welcome-subtitle {
            font-size: 16px;
            color: #666;
            margin-bottom: 20px;
        }

        .stats-container {
            display: flex;
            justify-content: space-around;
            width: 100%;
            max-width: 500px;
            margin-bottom: 30px;
        }

        .stat-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            width: 30%;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 14px;
            color: #666;
        }

        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
            max-width: 300px;
        }

        .btn {
            padding: 12px;
            border-radius: 5px;
            font-size: 16px;
            font-weight: 600;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: none;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-secondary {
            background-color: white;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .btn-secondary:hover {
            background-color: #f0f4f8;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .btn-danger {
            background-color: var(--danger-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d32f2f;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        /* 游戏界面 */
        .game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            padding: 20px;
            position: relative;
        }

        .game-canvas-container {
            position: relative;
            margin-bottom: 20px;
        }

        #gameCanvas {
            background-color: #222;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .game-stats {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 500px;
            margin-bottom: 15px;
        }

        .game-stat {
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            display: flex;
            align-items: center;
        }

        .game-stat i {
            margin-right: 5px;
        }

        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 10px;
            width: 200px;
            height: 200px;
            margin-top: 20px;
        }

        .mobile-btn {
            background-color: rgba(255, 255, 255, 0.3);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .mobile-btn:active {
            background-color: rgba(255, 255, 255, 0.5);
        }

        .up-btn {
            grid-column: 2;
            grid-row: 1;
        }

        .left-btn {
            grid-column: 1;
            grid-row: 2;
        }

        .right-btn {
            grid-column: 3;
            grid-row: 2;
        }

        .down-btn {
            grid-column: 2;
            grid-row: 3;
        }

        .action-btn {
            grid-column: 2;
            grid-row: 2;
            background-color: rgba(255, 255, 255, 0.5);
        }

        /* 游戏结束界面 */
        .game-over-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 100;
            border-radius: 10px;
            padding: 20px;
        }

        .game-over-title {
            font-size: 36px;
            color: white;
            margin-bottom: 20px;
            text-align: center;
        }

        .game-over-stats {
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            margin-bottom: 20px;
        }

        .game-over-stat {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .game-over-stat:last-child {
            margin-bottom: 0;
        }

        .stat-name {
            font-weight: 600;
            color: var(--dark-color);
        }

        .stat-value {
            color: var(--primary-color);
            font-weight: 700;
        }

        .new-highscore {
            color: var(--accent-color);
            font-weight: 700;
            text-align: center;
            margin-bottom: 20px;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .game-over-buttons {
            display: flex;
            gap: 15px;
            width: 100%;
            max-width: 400px;
        }

        /* 商店界面 */
        .shop-container {
            display: none;
            flex-direction: column;
            padding: 20px;
            flex: 1;
        }

        .shop-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .shop-title {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .shop-balance {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            font-size: 18px;
            font-weight: 600;
        }

        .coin-icon {
            color: var(--warning-color);
        }

        .key-icon {
            color: var(--accent-color);
        }

        .shop-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .shop-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .shop-tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .shop-items {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .shop-item {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            cursor: pointer;
            position: relative;
        }

        .shop-item:hover {
            transform: translateY(-5px);
        }

        .shop-item-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }

        .shop-item-info {
            padding: 15px;
        }

        .shop-item-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .shop-item-price {
            display: flex;
            align-items: center;
            gap: 5px;
            color: var(--warning-color);
            font-weight: 600;
        }

        .shop-item-owned {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: var(--success-color);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        .shop-item-equip {
            position: absolute;
            top: 10px;
            left: 10px;
            background-color: var(--primary-color);
            color: white;
            padding: 3px 8px;
            border-radius: 10px;
            font-size: 12px;
        }

        /* 排行榜界面 */
        .leaderboard-container {
            display: none;
            flex-direction: column;
            padding: 20px;
            flex: 1;
        }

        .leaderboard-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .leaderboard-title {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .leaderboard-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .leaderboard-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .leaderboard-tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 600;
        }

        .leaderboard-list {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            font-weight: 700;
            width: 30px;
            color: var(--primary-color);
        }

        .leaderboard-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 15px;
        }

        .leaderboard-user {
            flex: 1;
        }

        .leaderboard-username {
            font-weight: 600;
        }

        .leaderboard-badge {
            background-color: var(--warning-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
        }

        .leaderboard-admin {
            background-color: var(--danger-color);
        }

        .leaderboard-vip {
            background-color: var(--accent-color);
        }

        .leaderboard-score {
            font-weight: 700;
            color: var(--primary-color);
        }

        /* 个人资料界面 */
        .profile-container {
            display: none;
            flex-direction: column;
            padding: 20px;
            flex: 1;
        }

        .profile-header {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 30px;
        }

        .profile-avatar-container {
            position: relative;
            margin-bottom: 15px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary-color);
        }

        .profile-avatar-edit {
            position: absolute;
            bottom: 0;
            right: 0;
            background-color: var(--primary-color);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        .profile-username {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .profile-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            margin-bottom: 15px;
        }

        .profile-admin {
            background-color: var(--danger-color);
        }

        .profile-vip {
            background-color: var(--accent-color);
        }

        .profile-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .profile-stat {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .profile-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .profile-stat-label {
            font-size: 14px;
            color: #666;
        }

        .profile-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .profile-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .profile-form .form-group {
            margin-bottom: 15px;
        }

        .profile-form label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .profile-form input, .profile-form select {
            width: 100%;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .profile-form input:focus, .profile-form select:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* 管理员界面 */
        .admin-container {
            display: none;
            flex-direction: column;
            padding: 20px;
            flex: 1;
        }

        .admin-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .admin-title {
            font-size: 24px;
            color: var(--danger-color);
            margin-bottom: 10px;
        }

        .admin-tabs {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }

        .admin-tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
        }

        .admin-tab.active {
            border-bottom-color: var(--danger-color);
            color: var(--danger-color);
            font-weight: 600;
        }

        .admin-search {
            display: flex;
            margin-bottom: 20px;
        }

        .admin-search input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 5px 0 0 5px;
            font-size: 16px;
        }

        .admin-search button {
            padding: 10px 15px;
            background-color: var(--danger-color);
            color: white;
            border: none;
            border-radius: 0 5px 5px 0;
            cursor: pointer;
        }

        .admin-users-list {
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .admin-user-item {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid #eee;
        }

        .admin-user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            margin-right: 15px;
        }

        .admin-user-info {
            flex: 1;
        }

        .admin-username {
            font-weight: 600;
        }

        .admin-user-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 12px;
            margin-left: 5px;
        }

        .admin-user-admin {
            background-color: var(--danger-color);
        }

        .admin-user-vip {
            background-color: var(--accent-color);
        }

        .admin-user-actions {
            display: flex;
            gap: 10px;
        }

        .admin-action-btn {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            cursor: pointer;
            border: none;
        }

        .admin-promote-btn {
            background-color: var(--success-color);
            color: white;
        }

        .admin-ban-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .admin-gift-btn {
            background-color: var(--accent-color);
            color: white;
        }

        /* 开发者界面 */
        .developer-container {
            display: none;
            flex-direction: column;
            padding: 20px;
            flex: 1;
        }

        .developer-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .developer-title {
            font-size: 24px;
            color: var(--dark-color);
            margin-bottom: 10px;
        }

        .developer-stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 30px;
        }

        .developer-stat {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .developer-stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
            margin-bottom: 5px;
        }

        .developer-stat-label {
            font-size: 14px;
            color: #666;
        }

        .developer-section {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .developer-section-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .developer-actions {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .developer-action-btn {
            padding: 12px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        .developer-action-btn:hover {
            background-color: var(--secondary-color);
        }

        .developer-danger-btn {
            background-color: var(--danger-color);
        }

        .developer-danger-btn:hover {
            background-color: #d32f2f;
        }

        .developer-code-editor {
            width: 100%;
            height: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            font-family: monospace;
            font-size: 14px;
            margin-bottom: 15px;
        }

        /* 多人在线比拼界面 */
        .multiplayer-container {
            display: none;
            flex-direction: column;
            padding: 20px;
            flex: 1;
        }

        .multiplayer-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .multiplayer-title {
            font-size: 24px;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .multiplayer-status {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }

        .status-online {
            background-color: var(--success-color);
        }

        .status-offline {
            background-color: var(--danger-color);
        }

        .multiplayer-lobby {
            background-color: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }

        .lobby-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .lobby-title {
            font-size: 18px;
            font-weight: 600;
        }

        .lobby-players {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
        }

        .lobby-player {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 10px;
        }

        .lobby-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 10px;
        }

        .lobby-username {
            font-weight: 600;
            text-align: center;
        }

        .lobby-ready {
            margin-top: 5px;
            color: var(--success-color);
            font-size: 12px;
        }

        .lobby-waiting {
            margin-top: 5px;
            color: var(--warning-color);
            font-size: 12px;
        }

        .multiplayer-game-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            flex: 1;
            position: relative;
        }

        /* 响应式设计 */
        @media (max-width: 768px) {
            .stats-container {
                flex-direction: column;
                align-items: center;
                gap: 15px;
            }

            .stat-card {
                width: 100%;
                max-width: 300px;
            }

            .shop-items {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .mobile-controls {
                display: grid;
            }

            .profile-stats {
                grid-template-columns: 1fr;
            }

            .developer-stats {
                grid-template-columns: 1fr;
            }
        }

        /* 动画效果 */
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }

        .floating {
            animation: float 3s ease-in-out infinite;
        }

        /* 工具提示 */
        .tooltip {
            position: relative;
            display: inline-block;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 14px;
            font-weight: normal;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            animation: fadeIn 0.3s ease;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* 通知 */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: var(--success-color);
            color: white;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 10px;
            transform: translateX(200%);
            transition: transform 0.3s ease;
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.error {
            background-color: var(--danger-color);
        }

        .notification.warning {
            background-color: var(--warning-color);
        }

        .notification.info {
            background-color: var(--primary-color);
        }

        /* 加载动画 */
        .loader {
            display: inline-block;
            width: 30px;
            height: 30px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 4000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            gap: 15px;
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <!-- 登录/注册界面 -->
    <div class="auth-container" id="authContainer">
        <div class="auth-box">
            <h1 class="auth-title" id="authTitle">登录</h1>
            <form class="auth-form" id="authForm">
                <div class="form-group">
                    <label for="username">用户名</label>
                    <input type="text" id="username" placeholder="输入用户名" required>
                </div>
                <div class="form-group">
                    <label for="password">密码</label>
                    <input type="password" id="password" placeholder="输入密码" required>
                </div>
                <div class="remember-me" id="rememberMeContainer">
                    <input type="checkbox" id="rememberMe">
                    <label for="rememberMe">30天内自动登录</label>
                </div>
                <button type="submit" class="auth-btn" id="authBtn">登录</button>
            </form>
            <div class="auth-switch" id="authSwitch">
                还没有账号？<a href="#" id="switchLink">立即注册</a>
            </div>
        </div>
    </div>

    <!-- 主界面 -->
    <div class="main-container" id="mainContainer">
        <div class="header">
            <div class="logo">炸弹躲避大冒险</div>
            <div class="user-info">
                <span class="username" id="headerUsername">游客</span>
                <img src="https://via.placeholder.com/40" alt="头像" class="user-avatar" id="headerAvatar">
                <button class="menu-btn" id="menuBtn"><i class="fas fa-bars"></i></button>
            </div>
        </div>

        <!-- 侧边菜单 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-title">菜单</div>
                <button class="close-btn" id="closeMenuBtn">&times;</button>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">游戏</div>
                <div class="menu-item" id="homeMenuItem">
                    <i class="fas fa-home menu-icon"></i>
                    <span class="menu-text">主页</span>
                </div>
                <div class="menu-item" id="playMenuItem">
                    <i class="fas fa-gamepad menu-icon"></i>
                    <span class="menu-text">开始游戏</span>
                </div>
                <div class="menu-item" id="multiplayerMenuItem">
                    <i class="fas fa-users menu-icon"></i>
                    <span class="menu-text">多人比拼</span>
                    <span class="badge" id="onlineCount">0</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">个人</div>
                <div class="menu-item" id="profileMenuItem">
                    <i class="fas fa-user menu-icon"></i>
                    <span class="menu-text">个人资料</span>
                </div>
                <div class="menu-item" id="shopMenuItem">
                    <i class="fas fa-shopping-cart menu-icon"></i>
                    <span class="menu-text">商店</span>
                </div>
                <div class="menu-item" id="leaderboardMenuItem">
                    <i class="fas fa-trophy menu-icon"></i>
                    <span class="menu-text">排行榜</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">系统</div>
                <div class="menu-item" id="adminMenuItem" style="display: none;">
                    <i class="fas fa-shield-alt menu-icon"></i>
                    <span class="menu-text">管理员面板</span>
                </div>
                <div class="menu-item" id="developerMenuItem" style="display: none;">
                    <i class="fas fa-code menu-icon"></i>
                    <span class="menu-text">开发者模式</span>
                </div>
                <div class="menu-item" id="settingsMenuItem">
                    <i class="fas fa-cog menu-icon"></i>
                    <span class="menu-text">设置</span>
                </div>
                <div class="menu-item" id="logoutMenuItem">
                    <i class="fas fa-sign-out-alt menu-icon"></i>
                    <span class="menu-text">退出登录</span>
                </div>
            </div>
            
            <div class="sidebar-section">
                <div class="section-title">帮助</div>
                <div class="menu-item" id="helpMenuItem">
                    <i class="fas fa-question-circle menu-icon"></i>
                    <span class="menu-text">游戏帮助</span>
                </div>
                <div class="menu-item" id="qqGroupMenuItem">
                    <i class="fab fa-qq menu-icon"></i>
                    <span class="menu-text">加入QQ群</span>
                </div>
                <div class="menu-item" id="contactMenuItem">
                    <i class="fas fa-envelope menu-icon"></i>
                    <span class="menu-text">联系开发者</span>
                </div>
            </div>
        </div>

        <!-- 主页 -->
        <div class="home-container" id="homeContainer">
            <div class="welcome-message">
                <h1 class="welcome-title">欢迎回来, <span id="welcomeUsername">玩家</span>!</h1>
                <p class="welcome-subtitle">躲避炸弹，收集金币，成为排行榜上的冠军！</p>
            </div>
            
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-value" id="homeCoins">0</div>
                    <div class="stat-label">金币</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="homeKeys">0</div>
                    <div class="stat-label">钥匙</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="homeHighscore">0</div>
                    <div class="stat-label">最高分</div>
                </div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-primary" id="playBtn">开始游戏</button>
                <button class="btn btn-secondary" id="multiplayerBtn">多人比拼</button>
                <button class="btn btn-secondary" id="shopBtn">前往商店</button>
            </div>
        </div>

        <!-- 游戏界面 -->
        <div class="game-container" id="gameContainer">
            <div class="game-stats">
                <div class="game-stat">
                    <i class="fas fa-coins"></i> <span id="gameCoins">0</span>
                </div>
                <div class="game-stat">
                    <i class="fas fa-key"></i> <span id="gameKeys">0</span>
                </div>
                <div class="game-stat">
                    <i class="fas fa-heart"></i> <span id="gameLives">1</span>
                </div>
                <div class="game-stat">
                    <i class="fas fa-stopwatch"></i> <span id="gameTime">0</span>s
                </div>
                <div class="game-stat">
                    <i class="fas fa-trophy"></i> <span id="gameScore">0</span>
                </div>
            </div>
            
            <div class="game-canvas-container">
                <canvas id="gameCanvas" width="400" height="600"></canvas>
                
                <div class="game-over-container" id="gameOverContainer">
                    <h1 class="game-over-title">游戏结束</h1>
                    <div id="newHighscore" class="new-highscore" style="display: none;">新纪录！</div>
                    
                    <div class="game-over-stats">
                        <div class="game-over-stat">
                            <span class="stat-name">得分:</span>
                            <span class="stat-value" id="finalScore">0</span>
                        </div>
                        <div class="game-over-stat">
                            <span class="stat-name">时间:</span>
                            <span class="stat-value" id="finalTime">0s</span>
                        </div>
                        <div class="game-over-stat">
                            <span class="stat-name">收集金币:</span>
                            <span class="stat-value" id="finalCoins">0</span>
                        </div>
                        <div class="game-over-stat">
                            <span class="stat-name">收集钥匙:</span>
                            <span class="stat-value" id="finalKeys">0</span>
                        </div>
                    </div>
                    
                    <div class="game-over-buttons">
                        <button class="btn btn-primary" id="playAgainBtn">再来一局</button>
                        <button class="btn btn-secondary" id="goHomeBtn">返回主页</button>
                    </div>
                </div>
            </div>
            
            <div class="mobile-controls" id="mobileControls">
                <button class="mobile-btn up-btn" id="upBtn"><i class="fas fa-arrow-up"></i></button>
                <button class="mobile-btn left-btn" id="leftBtn"><i class="fas fa-arrow-left"></i></button>
                <button class="mobile-btn right-btn" id="rightBtn"><i class="fas fa-arrow-right"></i></button>
                <button class="mobile-btn down-btn" id="downBtn"><i class="fas fa-arrow-down"></i></button>
                <button class="mobile-btn action-btn" id="actionBtn"><i class="fas fa-bolt"></i></button>
            </div>
        </div>

        <!-- 商店界面 -->
        <div class="shop-container" id="shopContainer">
            <div class="shop-header">
                <h1 class="shop-title">商店</h1>
                <div class="shop-balance">
                    <span><i class="fas fa-coins coin-icon"></i> <span id="shopCoins">0</span></span>
                    <span><i class="fas fa-key key-icon"></i> <span id="shopKeys">0</span></span>
                </div>
            </div>
            
            <div class="shop-tabs">
                <div class="shop-tab active" data-tab="skins">皮肤</div>
                <div class="shop-tab" data-tab="avatars">头像</div>
                <div class="shop-tab" data-tab="powerups">道具</div>
                <div class="shop-tab" data-tab="vip">VIP</div>
            </div>
            
            <div class="shop-items" id="skinsTab">
                <!-- 皮肤商品将通过JS动态生成 -->
            </div>
            
            <div class="shop-items" id="avatarsTab" style="display: none;">
                <!-- 头像商品将通过JS动态生成 -->
            </div>
            
            <div class="shop-items" id="powerupsTab" style="display: none;">
                <!-- 道具商品将通过JS动态生成 -->
            </div>
            
            <div class="shop-items" id="vipTab" style="display: none;">
                <!-- VIP商品将通过JS动态生成 -->
            </div>
        </div>

        <!-- 排行榜界面 -->
        <div class="leaderboard-container" id="leaderboardContainer">
            <div class="leaderboard-header">
                <h1 class="leaderboard-title">排行榜</h1>
            </div>
            
            <div class="leaderboard-tabs">
                <div class="leaderboard-tab active" data-tab="all">全部玩家</div>
                <div class="leaderboard-tab" data-tab="friends">好友</div>
                <div class="leaderboard-tab" data-tab="today">今日最佳</div>
            </div>
            
            <div class="leaderboard-list" id="leaderboardList">
                <!-- 排行榜数据将通过JS动态生成 -->
            </div>
        </div>

        <!-- 个人资料界面 -->
        <div class="profile-container" id="profileContainer">
            <div class="profile-header">
                <div class="profile-avatar-container">
                    <img src="https://via.placeholder.com/100" alt="头像" class="profile-avatar" id="profileAvatar">
                    <div class="profile-avatar-edit" id="editAvatarBtn">
                        <i class="fas fa-pencil-alt"></i>
                    </div>
                </div>
                <h1 class="profile-username" id="profileUsername">玩家</h1>
                <div class="profile-badge" id="profileBadge">普通用户</div>
            </div>
            
            <div class="profile-stats">
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileCoins">0</div>
                    <div class="profile-stat-label">金币</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileKeys">0</div>
                    <div class="profile-stat-label">钥匙</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileHighscore">0</div>
                    <div class="profile-stat-label">最高分</div>
                </div>
                <div class="profile-stat">
                    <div class="profile-stat-value" id="profileGames">0</div>
                    <div class="profile-stat-label">游戏次数</div>
                </div>
            </div>
            
            <div class="profile-section">
                <h2 class="profile-section-title">个人信息</h2>
                <form class="profile-form" id="profileForm">
                    <div class="form-group">
                        <label for="profileNickname">昵称</label>
                        <input type="text" id="profileNickname" placeholder="输入昵称">
                    </div>
                    <div class="form-group">
                        <label for="profileStatus">状态</label>
                        <input type="text" id="profileStatus" placeholder="输入状态">
                    </div>
                    <button type="submit" class="btn btn-primary">保存更改</button>
                </form>
            </div>
            
            <div class="profile-section">
                <h2 class="profile-section-title">账号管理</h2>
                <button class="btn btn-secondary" id="switchAccountBtn">切换账号</button>
                <button class="btn btn-danger" id="logoutProfileBtn" style="margin-top: 10px;">退出登录</button>
            </div>
        </div>

        <!-- 管理员界面 -->
        <div class="admin-container" id="adminContainer">
            <div class="admin-header">
                <h1 class="admin-title">管理员面板</h1>
                <p>管理用户和游戏设置</p>
            </div>
            
            <div class="admin-tabs">
                <div class="admin-tab active" data-tab="users">用户管理</div>
                <div class="admin-tab" data-tab="reports">举报处理</div>
                <div class="admin-tab" data-tab="settings">游戏设置</div>
            </div>
            
            <div class="admin-search">
                <input type="text" placeholder="搜索用户..." id="adminSearchInput">
                <button id="adminSearchBtn"><i class="fas fa-search"></i></button>
            </div>
            
            <div class="admin-users-list" id="adminUsersList">
                <!-- 用户列表将通过JS动态生成 -->
            </div>
        </div>

        <!-- 开发者界面 -->
        <div class="developer-container" id="developerContainer">
            <div class="developer-header">
                <h1 class="developer-title">开发者模式</h1>
                <p>高级系统控制和网站管理</p>
            </div>
            
            <div class="developer-stats">
                <div class="developer-stat">
                    <div class="developer-stat-value" id="totalUsers">0</div>
                    <div class="developer-stat-label">总用户</div>
                </div>
                <div class="developer-stat">
                    <div class="developer-stat-value" id="activeUsers">0</div>
                    <div class="developer-stat-label">活跃用户</div>
                </div>
                <div class="developer-stat">
                    <div class="developer-stat-value" id="totalGames">0</div>
                    <div class="developer-stat-label">总游戏次数</div>
                </div>
            </div>
            
            <div class="developer-section">
                <h2 class="developer-section-title">账户管理</h2>
                <div class="developer-actions">
                    <button class="developer-action-btn" id="recoverAccountBtn">恢复账户</button>
                    <button class="developer-action-btn developer-danger-btn" id="resetPasswordBtn">重置密码</button>
                    <button class="developer-action-btn developer-danger-btn" id="deleteUserBtn">删除用户</button>
                </div>
            </div>
            
            <div class="developer-section">
                <h2 class="developer-section-title">网站更新</h2>
                <textarea class="developer-code-editor" id="codeEditor" placeholder="在此输入更新的HTML代码..."></textarea>
                <button class="developer-action-btn" id="updateWebsiteBtn">更新网站</button>
            </div>
            
            <div class="developer-section">
                <h2 class="developer-section-title">系统工具</h2>
                <div class="developer-actions">
                    <button class="developer-action-btn" id="backupBtn">备份数据</button>
                    <button class="developer-action-btn" id="clearCacheBtn">清除缓存</button>
                    <button class="developer-action-btn developer-danger-btn" id="resetSystemBtn">重置系统</button>
                </div>
            </div>
        </div>

        <!-- 多人在线比拼界面 -->
        <div class="multiplayer-container" id="multiplayerContainer">
            <div class="multiplayer-header">
                <h1 class="multiplayer-title">多人在线比拼</h1>
                <div class="multiplayer-status">
                    <div class="status-indicator status-online" id="statusIndicator"></div>
                    <span id="connectionStatus">连接中...</span>
                </div>
            </div>
            
            <div class="multiplayer-lobby">
                <div class="lobby-header">
                    <div class="lobby-title">游戏大厅</div>
                    <button class="btn btn-primary" id="findMatchBtn">寻找比赛</button>
                </div>
                
                <div class="lobby-players" id="lobbyPlayers">
                    <!-- 在线玩家将通过JS动态生成 -->
                </div>
            </div>
            
            <div class="multiplayer-game-container" id="multiplayerGameContainer" style="display: none;">
                <div class="game-stats">
                    <div class="game-stat">
                        <i class="fas fa-trophy"></i> <span id="mpScore">0</span>
                    </div>
                    <div class="game-stat">
                        <i class="fas fa-stopwatch"></i> <span id="mpTime">0</span>s
                    </div>
                    <div class="game-stat">
                        <i class="fas fa-users"></i> <span id="mpPlayers">1/1</span>
                    </div>
                </div>
                
                <div class="game-canvas-container">
                    <canvas id="mpGameCanvas" width="400" height="600"></canvas>
                </div>
                
                <div class="mobile-controls">
                    <button class="mobile-btn up-btn" id="mpUpBtn"><i class="fas fa-arrow-up"></i></button>
                    <button class="mobile-btn left-btn" id="mpLeftBtn"><i class="fas fa-arrow-left"></i></button>
                    <button class="mobile-btn right-btn" id="mpRightBtn"><i class="fas fa-arrow-right"></i></button>
                    <button class="mobile-btn down-btn" id="mpDownBtn"><i class="fas fa-arrow-down"></i></button>
                    <button class="mobile-btn action-btn" id="mpActionBtn"><i class="fas fa-bolt"></i></button>
                </div>
            </div>
        </div>
    </div>

    <!-- 模态框 -->
    <div class="modal" id="avatarModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">选择头像</h2>
                <button class="modal-close" id="closeAvatarModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="shop-items" id="avatarSelection">
                    <!-- 头像选择将通过JS动态生成 -->
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAvatarBtn">取消</button>
                <button class="btn btn-primary" id="saveAvatarBtn">保存</button>
            </div>
        </div>
    </div>

    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="confirmTitle">确认</h2>
                <button class="modal-close" id="closeConfirmModal">&times;</button>
            </div>
            <div class="modal-body" id="confirmMessage">
                您确定要执行此操作吗？
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelConfirmBtn">取消</button>
                <button class="btn btn-primary" id="confirmBtn">确定</button>
            </div>
        </div>
    </div>

    <div class="modal" id="keyModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">使用钥匙</h2>
                <button class="modal-close" id="closeKeyModal">&times;</button>
            </div>
            <div class="modal-body">
                <p>您被炸弹击中！是否使用钥匙继续游戏？</p>
                <p>当前钥匙: <span id="modalKeyCount">0</span></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="declineKeyBtn">放弃</button>
                <button class="btn btn-primary" id="useKeyBtn">使用钥匙</button>
            </div>
        </div>
    </div>

    <div class="modal" id="adminActionModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="adminActionTitle">管理员操作</h2>
                <button class="modal-close" id="closeAdminActionModal">&times;</button>
            </div>
            <div class="modal-body" id="adminActionBody">
                <!-- 内容将通过JS动态生成 -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancelAdminActionBtn">取消</button>
                <button class="btn btn-primary" id="confirmAdminActionBtn">确认</button>
            </div>
        </div>
    </div>

    <!-- 通知 -->
    <div class="notification" id="notification">
        <i class="fas fa-check-circle"></i>
        <span id="notificationMessage">操作成功</span>
    </div>

    <!-- 加载动画 -->
    <div class="loading-container" id="loadingContainer" style="display: none;">
        <div class="loader"></div>
        <div id="loadingText">加载中...</div>
    </div>

    <script>
        // 游戏数据
        const gameData = {
            // 用户数据
            users: [
                {
                    id: 1,
                    username: "admin",
                    password: "19996837879gxh",
                    nickname: "管理员",
                    avatar: "https://i.imgur.com/J6l19aX.png",
                    coins: 999999,
                    keys: 999999,
                    highscore: 0,
                    gamesPlayed: 0,
                    isAdmin: true,
                    isDeveloper: true,
                    isVIP: true,
                    status: "我是管理员",
                    lastLogin: new Date().toISOString(),
                    createdAt: new Date().toISOString(),
                    items: {
                        skins: [1, 2, 3, 4, 5, 6, 7, 8],
                        avatars: [1, 2, 3, 4, 5, 6, 7, 8],
                        powerups: [1, 2, 3]
                    },
                    equipped: {
                        skin: 1,
                        avatar: 1
                    }
                },
                {
                    id: 2,
                    username: "player1",
                    password: "123456",
                    nickname: "玩家一号",
                    avatar: "https://i.imgur.com/dM7ThnE.png",
                    coins: 500,
                    keys: 3,
                    highscore: 1200,
                    gamesPlayed: 15,
                    isAdmin: false,
                    isDeveloper: false,
                    isVIP: true,
                    status: "努力冲分中",
                    lastLogin: new Date().toISOString(),
                    createdAt: new Date(Date.now() - 86400000).toISOString(),
                    items: {
                        skins: [1, 2, 3],
                        avatars: [1, 2],
                        powerups: [1]
                    },
                    equipped: {
                        skin: 2,
                        avatar: 2
                    }
                },
                {
                    id: 3,
                    username: "player2",
                    password: "123456",
                    nickname: "炸弹专家",
                    avatar: "https://i.imgur.com/3QZQZ1Q.png",
                    coins: 200,
                    keys: 1,
                    highscore: 800,
                    gamesPlayed: 8,
                    isAdmin: false,
                    isDeveloper: false,
                    isVIP: false,
                    status: "新手玩家",
                    lastLogin: new Date(Date.now() - 3600000).toISOString(),
                    createdAt: new Date(Date.now() - 172800000).toISOString(),
                    items: {
                        skins: [1],
                        avatars: [1],
                        powerups: []
                    },
                    equipped: {
                        skin: 1,
                        avatar: 1
                    }
                }
            ],
            
            // 商店物品
            shopItems: {
                skins: [
                    {
                        id: 1,
                        name: "默认皮肤",
                        price: 0,
                        image: "https://i.imgur.com/dM7ThnE.png",
                        description: "默认游戏角色皮肤"
                    },
                    {
                        id: 2,
                        name: "蓝色战士",
                        price: 100,
                        image: "https://i.imgur.com/J6l19aX.png",
                        description: "蓝色的勇敢战士皮肤"
                    },
                    {
                        id: 3,
                        name: "红色勇者",
                        price: 150,
                        image: "https://i.imgur.com/3QZQZ1Q.png",
                        description: "红色的勇者皮肤"
                    },
                    {
                        id: 4,
                        name: "黄金英雄",
                        price: 300,
                        image: "https://i.imgur.com/4QZQZ1Q.png",
                        description: "闪亮的黄金英雄皮肤"
                    },
                    {
                        id: 5,
                        name: "暗夜刺客",
                        price: 250,
                        image: "https://i.imgur.com/5QZQZ1Q.png",
                        description: "暗夜中的刺客皮肤"
                    },
                    {
                        id: 6,
                        name: "机械战甲",
                        price: 400,
                        image: "https://i.imgur.com/6QZQZ1Q.png",
                        description: "高科技机械战甲皮肤"
                    },
                    {
                        id: 7,
                        name: "魔法精灵",
                        price: 350,
                        image: "https://i.imgur.com/7QZQZ1Q.png",
                        description: "神秘的魔法精灵皮肤"
                    },
                    {
                        id: 8,
                        name: "VIP专属",
                        price: 1000,
                        image: "https://i.imgur.com/8QZQZ1Q.png",
                        description: "VIP会员专属皮肤"
                    }
                ],
                avatars: [
                    {
                        id: 1,
                        name: "默认头像",
                        price: 0,
                        image: "https://i.imgur.com/dM7ThnE.png",
                        description: "默认用户头像"
                    },
                    {
                        id: 2,
                        name: "笑脸",
                        price: 50,
                        image: "https://i.imgur.com/J6l19aX.png",
                        description: "开心的笑脸头像"
                    },
                    {
                        id: 3,
                        name: "酷炫",
                        price: 80,
                        image: "https://i.imgur.com/3QZQZ1Q.png",
                        description: "酷炫风格头像"
                    },
                    {
                        id: 4,
                        name: "动物",
                        price: 120,
                        image: "https://i.imgur.com/4QZQZ1Q.png",
                        description: "可爱动物头像"
                    },
                    {
                        id: 5,
                        name: "动漫",
                        price: 150,
                        image: "https://i.imgur.com/5QZQZ1Q.png",
                        description: "动漫风格头像"
                    },
                    {
                        id: 6,
                        name: "自定义",
                        price: 200,
                        image: "https://i.imgur.com/6QZQZ1Q.png",
                        description: "上传自定义头像权限"
                    },
                    {
                        id: 7,
                        name: "VIP专属",
                        price: 500,
                        image: "https://i.imgur.com/7QZQZ1Q.png",
                        description: "VIP会员专属头像"
                    },
                    {
                        id: 8,
                        name: "管理员",
                        price: 0,
                        image: "https://i.imgur.com/8QZQZ1Q.png",
                        description: "管理员专属头像"
                    }
                ],
                powerups: [
                    {
                        id: 1,
                        name: "生命加成",
                        price: 200,
                        image: "https://i.imgur.com/dM7ThnE.png",
                        description: "游戏开始时额外获得1条生命"
                    },
                    {
                        id: 2,
                        name: "金币加倍",
                        price: 300,
                        image: "https://i.imgur.com/J6l19aX.png",
                        description: "获得的金币数量翻倍"
                    },
                    {
                        id: 3,
                        name: "钥匙礼包",
                        price: 150,
                        image: "https://i.imgur.com/3QZQZ1Q.png",
                        description: "获得3把钥匙"
                    }
                ],
                vip: [
                    {
                        id: 1,
                        name: "VIP月卡",
                        price: 200,
                        image: "https://i.imgur.com/dM7ThnE.png",
                        description: "30天VIP会员特权"
                    },
                    {
                        id: 2,
                        name: "VIP年卡",
                        price: 1000,
                        image: "https://i.imgur.com/J6l19aX.png",
                        description: "365天VIP会员特权"
                    }
                ]
            },
            
            // 游戏设置
            gameSettings: {
                baseSpeed: 2,
                speedIncrease: 0.1,
                itemSpawnRate: 0.02,
                bombSpawnRate: 0.03,
                initialLives: 1
            },
            
            // 当前状态
            currentUser: null,
            isLoggedIn: false,
            rememberMe: false,
            gameActive: false,
            multiplayerActive: false,
            onlinePlayers: [],
            adminSelectedUser: null,
            developerMode: false
        };

        // DOM元素
        const elements = {
            // 认证界面
            authContainer: document.getElementById('authContainer'),
            authTitle: document.getElementById('authTitle'),
            authForm: document.getElementById('authForm'),
            usernameInput: document.getElementById('username'),
            passwordInput: document.getElementById('password'),
            rememberMe: document.getElementById('rememberMe'),
            rememberMeContainer: document.getElementById('rememberMeContainer'),
            authBtn: document.getElementById('authBtn'),
            authSwitch: document.getElementById('authSwitch'),
            switchLink: document.getElementById('switchLink'),
            
            // 主界面
            mainContainer: document.getElementById('mainContainer'),
            headerUsername: document.getElementById('headerUsername'),
            headerAvatar: document.getElementById('headerAvatar'),
            menuBtn: document.getElementById('menuBtn'),
            sidebar: document.getElementById('sidebar'),
            closeMenuBtn: document.getElementById('closeMenuBtn'),
            
            // 主页
            homeContainer: document.getElementById('homeContainer'),
            welcomeUsername: document.getElementById('welcomeUsername'),
            homeCoins: document.getElementById('homeCoins'),
            homeKeys: document.getElementById('homeKeys'),
            homeHighscore: document.getElementById('homeHighscore'),
            playBtn: document.getElementById('playBtn'),
            multiplayerBtn: document.getElementById('multiplayerBtn'),
            shopBtn: document.getElementById('shopBtn'),
            
            // 游戏界面
            gameContainer: document.getElementById('gameContainer'),
            gameCanvas: document.getElementById('gameCanvas'),
            gameCoins: document.getElementById('gameCoins'),
            gameKeys: document.getElementById('gameKeys'),
            gameLives: document.getElementById('gameLives'),
            gameTime: document.getElementById('gameTime'),
            gameScore: document.getElementById('gameScore'),
            gameOverContainer: document.getElementById('gameOverContainer'),
            finalScore: document.getElementById('finalScore'),
            finalTime: document.getElementById('finalTime'),
            finalCoins: document.getElementById('finalCoins'),
            finalKeys: document.getElementById('finalKeys'),
            newHighscore: document.getElementById('newHighscore'),
            playAgainBtn: document.getElementById('playAgainBtn'),
            goHomeBtn: document.getElementById('goHomeBtn'),
            upBtn: document.getElementById('upBtn'),
            downBtn: document.getElementById('downBtn'),
            leftBtn: document.getElementById('leftBtn'),
            rightBtn: document.getElementById('rightBtn'),
            actionBtn: document.getElementById('actionBtn'),
            mobileControls: document.getElementById('mobileControls'),
            
            // 商店界面
            shopContainer: document.getElementById('shopContainer'),
            shopCoins: document.getElementById('shopCoins'),
            shopKeys: document.getElementById('shopKeys'),
            skinsTab: document.getElementById('skinsTab'),
            avatarsTab: document.getElementById('avatarsTab'),
            powerupsTab: document.getElementById('powerupsTab'),
            vipTab: document.getElementById('vipTab'),
            
            // 排行榜界面
            leaderboardContainer: document.getElementById('leaderboardContainer'),
            leaderboardList: document.getElementById('leaderboardList'),
            
            // 个人资料界面
            profileContainer: document.getElementById('profileContainer'),
            profileAvatar: document.getElementById('profileAvatar'),
            editAvatarBtn: document.getElementById('editAvatarBtn'),
            profileUsername: document.getElementById('profileUsername'),
            profileBadge: document.getElementById('profileBadge'),
            profileCoins: document.getElementById('profileCoins'),
            profileKeys: document.getElementById('profileKeys'),
            profileHighscore: document.getElementById('profileHighscore'),
            profileGames: document.getElementById('profileGames'),
            profileNickname: document.getElementById('profileNickname'),
            profileStatus: document.getElementById('profileStatus'),
            profileForm: document.getElementById('profileForm'),
            switchAccountBtn: document.getElementById('switchAccountBtn'),
            logoutProfileBtn: document.getElementById('logoutProfileBtn'),
            
            // 管理员界面
            adminContainer: document.getElementById('adminContainer'),
            adminSearchInput: document.getElementById('adminSearchInput'),
            adminSearchBtn: document.getElementById('adminSearchBtn'),
            adminUsersList: document.getElementById('adminUsersList'),
            
            // 开发者界面
            developerContainer: document.getElementById('developerContainer'),
            totalUsers: document.getElementById('totalUsers'),
            activeUsers: document.getElementById('activeUsers'),
            totalGames: document.getElementById('totalGames'),
            codeEditor: document.getElementById('codeEditor'),
            updateWebsiteBtn: document.getElementById('updateWebsiteBtn'),
            recoverAccountBtn: document.getElementById('recoverAccountBtn'),
            resetPasswordBtn: document.getElementById('resetPasswordBtn'),
            deleteUserBtn: document.getElementById('deleteUserBtn'),
            backupBtn: document.getElementById('backupBtn'),
            clearCacheBtn: document.getElementById('clearCacheBtn'),
            resetSystemBtn: document.getElementById('resetSystemBtn'),
            
            // 多人在线界面
            multiplayerContainer: document.getElementById('multiplayerContainer'),
            statusIndicator: document.getElementById('statusIndicator'),
            connectionStatus: document.getElementById('connectionStatus'),
            findMatchBtn: document.getElementById('findMatchBtn'),
            lobbyPlayers: document.getElementById('lobbyPlayers'),
            multiplayerGameContainer: document.getElementById('multiplayerGameContainer'),
            mpGameCanvas: document.getElementById('mpGameCanvas'),
            mpScore: document.getElementById('mpScore'),
            mpTime: document.getElementById('mpTime'),
            mpPlayers: document.getElementById('mpPlayers'),
            mpUpBtn: document.getElementById('mpUpBtn'),
            mpDownBtn: document.getElementById('mpDownBtn'),
            mpLeftBtn: document.getElementById('mpLeftBtn'),
            mpRightBtn: document.getElementById('mpRightBtn'),
            mpActionBtn: document.getElementById('mpActionBtn'),
            
            // 菜单项
            homeMenuItem: document.getElementById('homeMenuItem'),
            playMenuItem: document.getElementById('playMenuItem'),
            multiplayerMenuItem: document.getElementById('multiplayerMenuItem'),
            profileMenuItem: document.getElementById('profileMenuItem'),
            shopMenuItem: document.getElementById('shopMenuItem'),
            leaderboardMenuItem: document.getElementById('leaderboardMenuItem'),
            adminMenuItem: document.getElementById('adminMenuItem'),
            developerMenuItem: document.getElementById('developerMenuItem'),
            settingsMenuItem: document.getElementById('settingsMenuItem'),
            logoutMenuItem: document.getElementById('logoutMenuItem'),
            helpMenuItem: document.getElementById('helpMenuItem'),
            qqGroupMenuItem: document.getElementById('qqGroupMenuItem'),
            contactMenuItem: document.getElementById('contactMenuItem'),
            onlineCount: document.getElementById('onlineCount'),
            
            // 模态框
            avatarModal: document.getElementById('avatarModal'),
            closeAvatarModal: document.getElementById('closeAvatarModal'),
            avatarSelection: document.getElementById('avatarSelection'),
            cancelAvatarBtn: document.getElementById('cancelAvatarBtn'),
            saveAvatarBtn: document.getElementById('saveAvatarBtn'),
            confirmModal: document.getElementById('confirmModal'),
            confirmTitle: document.getElementById('confirmTitle'),
            confirmMessage: document.getElementById('confirmMessage'),
            closeConfirmModal: document.getElementById('closeConfirmModal'),
            cancelConfirmBtn: document.getElementById('cancelConfirmBtn'),
            confirmBtn: document.getElementById('confirmBtn'),
            keyModal: document.getElementById('keyModal'),
            closeKeyModal: document.getElementById('closeKeyModal'),
            modalKeyCount: document.getElementById('modalKeyCount'),
            declineKeyBtn: document.getElementById('declineKeyBtn'),
            useKeyBtn: document.getElementById('useKeyBtn'),
            adminActionModal: document.getElementById('adminActionModal'),
            adminActionTitle: document.getElementById('adminActionTitle'),
            adminActionBody: document.getElementById('adminActionBody'),
            closeAdminActionModal: document.getElementById('closeAdminActionModal'),
            cancelAdminActionBtn: document.getElementById('cancelAdminActionBtn'),
            confirmAdminActionBtn: document.getElementById('confirmAdminActionBtn'),
            
            // 通知
            notification: document.getElementById('notification'),
            notificationMessage: document.getElementById('notificationMessage'),
            
            // 加载
            loadingContainer: document.getElementById('loadingContainer'),
            loadingText: document.getElementById('loadingText')
        };

        // 游戏变量
        let game = {
            ctx: null,
            player: {
                x: 0,
                y: 0,
                width: 30,
                height: 30,
                speed: 5,
                color: '#4CAF50',
                skin: null
            },
            bombs: [],
            items: [],
            keys: {
                up: false,
                down: false,
                left: false,
                right: false
            },
            score: 0,
            coins: 0,
            keysCollected: 0,
            lives: 1,
            time: 0,
            speed: 2,
            gameLoop: null,
            lastTime: 0,
            gameWidth: 0,
            gameHeight: 0,
            itemImages: {},
            bombImage: null,
            playerImage: null
        };

        // 多人在线游戏变量
        let multiplayerGame = {
            ctx: null,
            players: [],
            bombs: [],
            items: [],
            score: 0,
            time: 0,
            speed: 2,
            gameLoop: null,
            lastTime: 0
        };

        // 初始化函数
        function init() {
            // 检查本地存储中的登录状态
            checkLoginStatus();
            
            // 设置事件监听器
            setupEventListeners();
            
            // 初始化游戏画布
            initGameCanvas();
            
            // 初始化多人在线游戏画布
            initMultiplayerCanvas();
            
            // 加载图像
            loadImages();
            
            // 模拟在线玩家
            simulateOnlinePlayers();
        }

        // 检查登录状态
        function checkLoginStatus() {
            const rememberMe = localStorage.getItem('rememberMe') === 'true';
            const savedUsername = localStorage.getItem('username');
            const savedPassword = localStorage.getItem('password');
            
            if (rememberMe && savedUsername && savedPassword) {
                elements.rememberMe.checked = true;
                elements.usernameInput.value = savedUsername;
                elements.passwordInput.value = savedPassword;
                
                // 自动登录
                setTimeout(() => {
                    elements.authBtn.click();
                }, 500);
            }
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 认证表单
            elements.authForm.addEventListener('submit', handleAuthSubmit);
            elements.switchLink.addEventListener('click', toggleAuthMode);
            
            // 菜单按钮
            elements.menuBtn.addEventListener('click', toggleSidebar);
            elements.closeMenuBtn.addEventListener('click', toggleSidebar);
            
            // 菜单项
            elements.homeMenuItem.addEventListener('click', () => showSection('home'));
            elements.playMenuItem.addEventListener('click', () => showSection('game'));
            elements.multiplayerMenuItem.addEventListener('click', () => showSection('multiplayer'));
            elements.profileMenuItem.addEventListener('click', () => showSection('profile'));
            elements.shopMenuItem.addEventListener('click', () => showSection('shop'));
            elements.leaderboardMenuItem.addEventListener('click', () => showSection('leaderboard'));
            elements.adminMenuItem.addEventListener('click', () => showSection('admin'));
            elements.developerMenuItem.addEventListener('click', () => showSection('developer'));
            elements.settingsMenuItem.addEventListener('click', showSettings);
            elements.logoutMenuItem.addEventListener('click', logout);
            elements.helpMenuItem.addEventListener('click', showHelp);
            elements.qqGroupMenuItem.addEventListener('click', joinQQGroup);
            elements.contactMenuItem.addEventListener('click', contactDeveloper);
            
            // 主页按钮
            elements.playBtn.addEventListener('click', () => showSection('game'));
            elements.multiplayerBtn.addEventListener('click', () => showSection('multiplayer'));
            elements.shopBtn.addEventListener('click', () => showSection('shop'));
            
            // 游戏界面按钮
            elements.playAgainBtn.addEventListener('click', startGame);
            elements.goHomeBtn.addEventListener('click', () => showSection('home'));
            
            // 移动控制按钮
            elements.upBtn.addEventListener('touchstart', () => game.keys.up = true);
            elements.upBtn.addEventListener('touchend', () => game.keys.up = false);
            elements.downBtn.addEventListener('touchstart', () => game.keys.down = true);
            elements.downBtn.addEventListener('touchend', () => game.keys.down = false);
            elements.leftBtn.addEventListener('touchstart', () => game.keys.left = true);
            elements.leftBtn.addEventListener('touchend', () => game.keys.left = false);
            elements.rightBtn.addEventListener('touchstart', () => game.keys.right = true);
            elements.rightBtn.addEventListener('touchend', () => game.keys.right = false);
            elements.actionBtn.addEventListener('click', useKey);
            
            // 多人在线控制按钮
            elements.mpUpBtn.addEventListener('touchstart', () => {/* 多人在线上移 */});
            elements.mpUpBtn.addEventListener('touchend', () => {/* 停止上移 */});
            elements.mpDownBtn.addEventListener('touchstart', () => {/* 多人在线下移 */});
            elements.mpDownBtn.addEventListener('touchend', () => {/* 停止下移 */});
            elements.mpLeftBtn.addEventListener('touchstart', () => {/* 多人在线左移 */});
            elements.mpLeftBtn.addEventListener('touchend', () => {/* 停止左移 */});
            elements.mpRightBtn.addEventListener('touchstart', () => {/* 多人在线右移 */});
            elements.mpRightBtn.addEventListener('touchend', () => {/* 停止右移 */});
            elements.mpActionBtn.addEventListener('click', () => {/* 多人在线使用钥匙 */});
            
            // 商店标签
            document.querySelectorAll('.shop-tab').forEach(tab => {
                tab.addEventListener('click', () => switchShopTab(tab.dataset.tab));
            });
            
            // 排行榜标签
            document.querySelectorAll('.leaderboard-tab').forEach(tab => {
                tab.addEventListener('click', () => switchLeaderboardTab(tab.dataset.tab));
            });
            
            // 管理员标签
            document.querySelectorAll('.admin-tab').forEach(tab => {
                tab.addEventListener('click', () => switchAdminTab(tab.dataset.tab));
            });
            
            // 个人资料表单
            elements.profileForm.addEventListener('submit', saveProfile);
            elements.switchAccountBtn.addEventListener('click', switchAccount);
            elements.logoutProfileBtn.addEventListener('click', logout);
            elements.editAvatarBtn.addEventListener('click', openAvatarModal);
            
            // 头像模态框
            elements.closeAvatarModal.addEventListener('click', closeAvatarModal);
            elements.cancelAvatarBtn.addEventListener('click', closeAvatarModal);
            elements.saveAvatarBtn.addEventListener('click', saveAvatar);
            
            // 确认模态框
            elements.closeConfirmModal.addEventListener('click', closeConfirmModal);
            elements.cancelConfirmBtn.addEventListener('click', closeConfirmModal);
            
            // 钥匙模态框
            elements.closeKeyModal.addEventListener('click', closeKeyModal);
            elements.declineKeyBtn.addEventListener('click', declineKey);
            elements.useKeyBtn.addEventListener('click', useKeyConfirm);
            
            // 管理员操作模态框
            elements.closeAdminActionModal.addEventListener('click', closeAdminActionModal);
            elements.cancelAdminActionBtn.addEventListener('click', closeAdminActionModal);
            
            // 管理员搜索
            elements.adminSearchBtn.addEventListener('click', searchUsers);
            elements.adminSearchInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') searchUsers();
            });
            
            // 开发者按钮
            elements.updateWebsiteBtn.addEventListener('click', updateWebsite);
            elements.recoverAccountBtn.addEventListener('click', recoverAccount);
            elements.resetPasswordBtn.addEventListener('click', resetPassword);
            elements.deleteUserBtn.addEventListener('click', deleteUser);
            elements.backupBtn.addEventListener('click', backupData);
            elements.clearCacheBtn.addEventListener('click', clearCache);
            elements.resetSystemBtn.addEventListener('click', resetSystem);
            
            // 多人在线按钮
            elements.findMatchBtn.addEventListener('click', findMatch);
            
            // 键盘控制
            window.addEventListener('keydown', handleKeyDown);
            window.addEventListener('keyup', handleKeyUp);
        }

        // 处理认证表单提交
        function handleAuthSubmit(e) {
            e.preventDefault();
            
            const username = elements.usernameInput.value.trim();
            const password = elements.passwordInput.value;
            const rememberMe = elements.rememberMe.checked;
            
            // 检查管理员登录
            if (username === '3530388417' && password === '19996837879gxh') {
                loginAsAdmin();
                return;
            }
            
            // 查找用户
            const user = gameData.users.find(u => u.username === username && u.password === password);
            
            if (user) {
                // 登录成功
                loginUser(user, rememberMe);
            } else {
                // 登录失败
                showNotification('用户名或密码错误', 'error');
            }
        }

        // 切换认证模式（登录/注册）
        function toggleAuthMode(e) {
            e.preventDefault();
            
            if (elements.authTitle.textContent === '登录') {
                elements.authTitle.textContent = '注册';
                elements.authBtn.textContent = '注册';
                elements.switchLink.textContent = '已有账号？立即登录';
                elements.rememberMeContainer.style.display = 'none';
            } else {
                elements.authTitle.textContent = '登录';
                elements.authBtn.textContent = '登录';
                elements.switchLink.textContent = '还没有账号？立即注册';
                elements.rememberMeContainer.style.display = 'flex';
            }
        }

        // 以管理员身份登录
        function loginAsAdmin() {
            const admin = gameData.users.find(u => u.isAdmin);
            loginUser(admin, true);
            gameData.developerMode = true;
            showNotification('开发者模式已激活', 'success');
        }

        // 登录用户
        function loginUser(user, rememberMe) {
            gameData.currentUser = user;
            gameData.isLoggedIn = true;
            gameData.rememberMe = rememberMe;
            
            // 更新最后登录时间
            user.lastLogin = new Date().toISOString();
            
            // 保存登录状态
            if (rememberMe) {
                localStorage.setItem('username', user.username);
                localStorage.setItem('password', user.password);
                localStorage.setItem('rememberMe', 'true');
            } else {
                localStorage.removeItem('username');
                localStorage.removeItem('password');
                localStorage.removeItem('rememberMe');
            }
            
            // 切换界面
            elements.authContainer.style.display = 'none';
            elements.mainContainer.style.display = 'flex';
            
            // 更新用户界面
            updateUserUI();
            
            // 显示主页
            showSection('home');
            
            // 显示通知
            showNotification(`欢迎回来，${user.nickname || user.username}！`, 'success');
            
            // 显示管理员菜单（如果是管理员）
            if (user.isAdmin) {
                elements.adminMenuItem.style.display = 'flex';
            } else {
                elements.adminMenuItem.style.display = 'none';
            }
            
            // 显示开发者菜单（如果是开发者）
            if (user.isDeveloper) {
                elements.developerMenuItem.style.display = 'flex';
            } else {
                elements.developerMenuItem.style.display = 'none';
            }
        }

        // 更新用户界面
        function updateUserUI() {
            const user = gameData.currentUser;
            
            // 更新头部
            elements.headerUsername.textContent = user.nickname || user.username;
            elements.headerAvatar.src = user.avatar;
            
            // 更新主页
            elements.welcomeUsername.textContent = user.nickname || user.username;
            elements.homeCoins.textContent = user.coins;
            elements.homeKeys.textContent = user.keys;
            elements.homeHighscore.textContent = user.highscore;
            
            // 更新个人资料
            elements.profileUsername.textContent = user.nickname || user.username;
            elements.profileAvatar.src = user.avatar;
            elements.profileCoins.textContent = user.coins;
            elements.profileKeys.textContent = user.keys;
            elements.profileHighscore.textContent = user.highscore;
            elements.profileGames.textContent = user.gamesPlayed;
            elements.profileNickname.value = user.nickname || '';
            elements.profileStatus.value = user.status || '';
            
            // 更新徽章
            if (user.isAdmin) {
                elements.profileBadge.textContent = '管理员';
                elements.profileBadge.className = 'profile-badge profile-admin';
            } else if (user.isVIP) {
                elements.profileBadge.textContent = 'VIP会员';
                elements.profileBadge.className = 'profile-badge profile-vip';
            } else {
                elements.profileBadge.textContent = '普通用户';
                elements.profileBadge.className = 'profile-badge';
            }
            
            // 更新商店余额
            elements.shopCoins.textContent = user.coins;
            elements.shopKeys.textContent = user.keys;
            
            // 加载商店物品
            loadShopItems();
            
            // 加载排行榜
            loadLeaderboard();
            
            // 加载管理员用户列表
            if (user.isAdmin) {
                loadAdminUsers();
            }
            
            // 更新开发者统计
            if (user.isDeveloper) {
                updateDeveloperStats();
            }
        }

        // 切换侧边栏
        function toggleSidebar() {
            elements.sidebar.classList.toggle('open');
        }

        // 显示特定部分
        function showSection(section) {
            // 隐藏所有部分
            document.querySelectorAll('.home-container, .game-container, .shop-container, .leaderboard-container, .profile-container, .admin-container, .developer-container, .multiplayer-container').forEach(el => {
                el.style.display = 'none';
            });
            
            // 停止当前游戏
            if (gameData.gameActive) {
                stopGame();
            }
            
            if (gameData.multiplayerActive) {
                stopMultiplayerGame();
            }
            
            // 显示选定的部分
            switch (section) {
                case 'home':
                    elements.homeContainer.style.display = 'flex';
                    break;
                case 'game':
                    elements.gameContainer.style.display = 'flex';
                    startGame();
                    break;
                case 'shop':
                    elements.shopContainer.style.display = 'flex';
                    break;
                case 'leaderboard':
                    elements.leaderboardContainer.style.display = 'flex';
                    break;
                case 'profile':
                    elements.profileContainer.style.display = 'flex';
                    break;
                case 'admin':
                    if (gameData.currentUser.isAdmin) {
                        elements.adminContainer.style.display = 'flex';
                    } else {
                        showSection('home');
                    }
                    break;
                case 'developer':
                    if (gameData.currentUser.isDeveloper) {
                        elements.developerContainer.style.display = 'flex';
                    } else {
                        showSection('home');
                    }
                    break;
                case 'multiplayer':
                    elements.multiplayerContainer.style.display = 'flex';
                    break;
                default:
                    elements.homeContainer.style.display = 'flex';
            }
            
            // 关闭侧边栏
            elements.sidebar.classList.remove('open');
        }

        // 初始化游戏画布
        function initGameCanvas() {
            game.ctx = elements.gameCanvas.getContext('2d');
            game.gameWidth = elements.gameCanvas.width;
            game.gameHeight = elements.gameCanvas.height;
            
            // 设置玩家初始位置
            game.player.x = game.gameWidth / 2 - game.player.width / 2;
            game.player.y = game.gameHeight - game.player.height - 20;
            
            // 设置玩家皮肤
            if (gameData.currentUser) {
                const skinId = gameData.currentUser.equipped.skin;
                const skin = gameData.shopItems.skins.find(s => s.id === skinId);
                if (skin) {
                    game.player.skin = skin.image;
                }
            }
        }

        // 初始化多人在线游戏画布
        function initMultiplayerCanvas() {
            multiplayerGame.ctx = elements.mpGameCanvas.getContext('2d');
        }

        // 加载图像
        function loadImages() {
            // 炸弹图像
            game.bombImage = new Image();
            game.bombImage.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23222" stroke="%23fff" stroke-width="2"/><circle cx="50" cy="50" r="35" fill="%23f44336"/><path d="M30,30 L40,20 M60,20 L70,30 M30,70 L20,60 M70,70 L80,60" stroke="%23fff" stroke-width="3"/></svg>';
            
            // 玩家图像
            game.playerImage = new Image();
            game.playerImage.src = 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="30" r="20" fill="%234CAF50"/><circle cx="50" cy="30" r="15" fill="%238BC34A"/><path d="M40,70 L60,70 L55,90 L45,90 Z" fill="%234CAF50"/><path d="M30,40 L20,60 L40,50 Z M70,40 L80,60 L60,50 Z" fill="%234CAF50"/></svg>';
            
            // 物品图像
            game.itemImages = {
                coin: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23FFC107" stroke="%23FFA000" stroke-width="5"/><text x="50" y="60" font-size="40" text-anchor="middle" fill="%23FFA000">5</text></svg>',
                key: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M70,50 C70,30 50,30 50,50 C30,50 30,70 50,70 L50,90 L70,90 L70,70 L90,70 L90,50 L70,50 Z M50,50 L30,30" stroke="%232196F3" stroke-width="10" fill="none"/><circle cx="30" cy="30" r="10" fill="%232196F3"/></svg>',
                life: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><path d="M50,20 C60,0 90,0 90,30 C90,60 50,90 50,90 C50,90 10,60 10,30 C10,0 40,0 50,20 Z" fill="%23F44336"/></svg>',
                speedUp: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%234CAF50"/><path d="M30,50 L70,50 M50,30 L50,70" stroke="%23fff" stroke-width="10"/></svg>',
                speedDown: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="40" fill="%23F44336"/><path d="M30,50 L70,50" stroke="%23fff" stroke-width="10"/></svg>'
            };
        }

        // 开始游戏
        function startGame() {
            // 重置游戏状态
            game.bombs = [];
            game.items = [];
            game.score = 0;
            game.coins = 0;
            game.keysCollected = 0;
            game.time = 0;
            game.speed = gameData.gameSettings.baseSpeed;
            game.lives = gameData.gameSettings.initialLives;
            
            // 如果有生命加成道具，增加生命
            if (gameData.currentUser.items.powerups.includes(1)) {
                game.lives++;
            }
            
            // 设置玩家初始位置
            game.player.x = game.gameWidth / 2 - game.player.width / 2;
            game.player.y = game.gameHeight - game.player.height - 20;
            
            // 更新UI
            elements.gameScore.textContent = game.score;
            elements.gameCoins.textContent = game.coins;
            elements.gameKeys.textContent = game.keysCollected;
            elements.gameLives.textContent = game.lives;
            elements.gameTime.textContent = game.time;
            
            // 隐藏游戏结束界面
            elements.gameOverContainer.style.display = 'none';
            
            // 开始游戏循环
            gameData.gameActive = true;
            game.lastTime = Date.now();
            game.gameLoop = requestAnimationFrame(updateGame);
            
            // 显示游戏界面
            elements.gameContainer.style.display = 'flex';
        }

        // 更新游戏状态
        function updateGame() {
            if (!gameData.gameActive) return;
            
            const currentTime = Date.now();
            const deltaTime = (currentTime - game.lastTime) / 1000;
            game.lastTime = currentTime;
            
            // 更新游戏时间
            game.time += deltaTime;
            elements.gameTime.textContent = Math.floor(game.time);
            
            // 增加难度
            game.speed = gameData.gameSettings.baseSpeed + (game.time * gameData.gameSettings.speedIncrease);
            
            // 清除画布
            game.ctx.clearRect(0, 0, game.gameWidth, game.gameHeight);
            
            // 移动玩家
            if (game.keys.left && game.player.x > 0) {
                game.player.x -= game.player.speed;
            }
            if (game.keys.right && game.player.x < game.gameWidth - game.player.width) {
                game.player.x += game.player.speed;
            }
            if (game.keys.up && game.player.y > 0) {
                game.player.y -= game.player.speed;
            }
            if (game.keys.down && game.player.y < game.gameHeight - game.player.height) {
                game.player.y += game.player.speed;
            }
            
            // 生成炸弹
            if (Math.random() < gameData.gameSettings.bombSpawnRate * game.speed) {
                spawnBomb();
            }
            
            // 生成物品
            if (Math.random() < gameData.gameSettings.itemSpawnRate * game.speed) {
                spawnItem();
            }
            
            // 更新炸弹位置
            for (let i = game.bombs.length - 1; i >= 0; i--) {
                const bomb = game.bombs[i];
                bomb.y += bomb.speed * game.speed;
                
                // 绘制炸弹
                drawBomb(bomb);
                
                // 检测碰撞
                if (checkCollision(game.player, bomb)) {
                    handleBombCollision();
                    game.bombs.splice(i, 1);
                    continue;
                }
                
                // 移除超出屏幕的炸弹
                if (bomb.y > game.gameHeight) {
                    game.bombs.splice(i, 1);
                }
            }
            
            // 更新物品位置
            for (let i = game.items.length - 1; i >= 0; i--) {
                const item = game.items[i];
                item.y += item.speed * game.speed;
                
                // 绘制物品
                drawItem(item);
                
                // 检测碰撞
                if (checkCollision(game.player, item)) {
                    handleItemCollision(item);
                    game.items.splice(i, 1);
                    continue;
                }
                
                // 移除超出屏幕的物品
                if (item.y > game.gameHeight) {
                    game.items.splice(i, 1);
                }
            }
            
            // 绘制玩家
            drawPlayer();
            
            // 继续游戏循环
            game.gameLoop = requestAnimationFrame(updateGame);
        }

        // 生成炸弹
        function spawnBomb() {
            const bomb = {
                x: Math.random() * (game.gameWidth - 30),
                y: -30,
                width: 30,
                height: 30,
                speed: 3 + Math.random() * 2
            };
            game.bombs.push(bomb);
        }

        // 生成物品
        function spawnItem() {
            const itemTypes = ['coin', 'key', 'life', 'speedUp', 'speedDown'];
            const weights = [0.5, 0.2, 0.1, 0.1, 0.1]; // 物品生成权重
            const totalWeight = weights.reduce((a, b) => a + b, 0);
            let random = Math.random() * totalWeight;
            let typeIndex = 0;
            
            for (let i = 0; i < weights.length; i++) {
                if (random < weights[i]) {
                    typeIndex = i;
                    break;
                }
                random -= weights[i];
            }
            
            const item = {
                x: Math.random() * (game.gameWidth - 30),
                y: -30,
                width: 30,
                height: 30,
                speed: 2 + Math.random() * 2,
                type: itemTypes[typeIndex]
            };
            game.items.push(item);
        }

        // 绘制炸弹
        function drawBomb(bomb) {
            if (game.bombImage.complete) {
                game.ctx.drawImage(game.bombImage, bomb.x, bomb.y, bomb.width, bomb.height);
            } else {
                game.ctx.fillStyle = '#f44336';
                game.ctx.beginPath();
                game.ctx.arc(bomb.x + bomb.width / 2, bomb.y + bomb.height / 2, bomb.width / 2, 0, Math.PI * 2);
                game.ctx.fill();
            }
        }

        // 绘制物品
        function drawItem(item) {
            if (game.itemImages[item.type]) {
                const img = new Image();
                img.src = game.itemImages[item.type];
                
                if (img.complete) {
                    game.ctx.drawImage(img, item.x, item.y, item.width, item.height);
                } else {
                    // 备用绘制
                    game.ctx.fillStyle = getItemColor(item.type);
                    game.ctx.fillRect(item.x, item.y, item.width, item.height);
                }
            } else {
                // 备用绘制
                game.ctx.fillStyle = getItemColor(item.type);
                game.ctx.fillRect(item.x, item.y, item.width, item.height);
            }
        }

        // 获取物品颜色
        function getItemColor(type) {
            switch (type) {
                case 'coin': return '#FFC107';
                case 'key': return '#2196F3';
                case 'life': return '#F44336';
                case 'speedUp': return '#4CAF50';
                case 'speedDown': return '#FF9800';
                default: return '#9E9E9E';
            }
        }

        // 绘制玩家
        function drawPlayer() {
            if (game.player.skin) {
                const img = new Image();
                img.src = game.player.skin;
                
                if (img.complete) {
                    game.ctx.drawImage(img, game.player.x, game.player.y, game.player.width, game.player.height);
                } else {
                    // 备用绘制
                    game.ctx.fillStyle = game.player.color;
                    game.ctx.fillRect(game.player.x, game.player.y, game.player.width, game.player.height);
                }
            } else if (game.playerImage.complete) {
                game.ctx.drawImage(game.playerImage, game.player.x, game.player.y, game.player.width, game.player.height);
            } else {
                // 备用绘制
                game.ctx.fillStyle = game.player.color;
                game.ctx.fillRect(game.player.x, game.player.y, game.player.width, game.player.height);
            }
        }

        // 检测碰撞
        function checkCollision(obj1, obj2) {
            return obj1.x < obj2.x + obj2.width &&
                   obj1.x + obj1.width > obj2.x &&
                   obj1.y < obj2.y + obj2.height &&
                   obj1.y + obj1.height > obj2.y;
        }

        // 处理炸弹碰撞
        function handleBombCollision() {
            if (game.lives > 1) {
                // 有额外生命，消耗一条生命
                game.lives--;
                elements.gameLives.textContent = game.lives;
                showNotification('被炸弹击中！失去一条生命', 'warning');
            } else if (game.keysCollected > 0) {
                // 有钥匙，询问是否使用
                elements.modalKeyCount.textContent = game.keysCollected;
                showModal('keyModal');
            } else {
                // 游戏结束
                endGame();
            }
        }

        // 处理物品碰撞
        function handleItemCollision(item) {
            switch (item.type) {
                case 'coin':
                    game.coins += 5;
                    game.score += 10;
                    elements.gameCoins.textContent = game.coins;
                    elements.gameScore.textContent = game.score;
                    showNotification('+5 金币', 'info');
                    break;
                case 'key':
                    game.keysCollected++;
                    game.score += 20;
                    elements.gameKeys.textContent = game.keysCollected;
                    elements.gameScore.textContent = game.score;
                    showNotification('+1 钥匙', 'info');
                    break;
                case 'life':
                    game.lives++;
                    game.score += 15;
                    elements.gameLives.textContent = game.lives;
                    elements.gameScore.textContent = game.score;
                    showNotification('+1 生命', 'success');
                    break;
                case 'speedUp':
                    game.speed = Math.max(1, game.speed - 0.5);
                    showNotification('速度降低', 'info');
                    break;
                case 'speedDown':
                    game.speed += 0.5;
                    showNotification('速度增加', 'warning');
                    break;
            }
        }

        // 结束游戏
        function endGame() {
            gameData.gameActive = false;
            cancelAnimationFrame(game.gameLoop);
            
            // 更新游戏统计数据
            elements.finalScore.textContent = game.score;
            elements.finalTime.textContent = Math.floor(game.time);
            elements.finalCoins.textContent = game.coins;
            elements.finalKeys.textContent = game.keysCollected;
            
            // 检查是否打破记录
            if (game.score > gameData.currentUser.highscore) {
                gameData.currentUser.highscore = game.score;
                elements.newHighscore.style.display = 'block';
                showNotification('新纪录！', 'success');
            } else {
                elements.newHighscore.style.display = 'none';
            }
            
            // 更新用户数据
            gameData.currentUser.coins += game.coins;
            gameData.currentUser.keys += game.keysCollected;
            gameData.currentUser.gamesPlayed++;
            
            // 显示游戏结束界面
            elements.gameOverContainer.style.display = 'flex';
            
            // 更新UI
            updateUserUI();
        }

        // 停止游戏
        function stopGame() {
            gameData.gameActive = false;
            cancelAnimationFrame(game.gameLoop);
        }

        // 使用钥匙
        function useKey() {
            if (game.keysCollected > 0) {
                elements.modalKeyCount.textContent = game.keysCollected;
                showModal('keyModal');
            }
        }

        // 拒绝使用钥匙
        function declineKey() {
            closeModal('keyModal');
            endGame();
        }

        // 确认使用钥匙
        function useKeyConfirm() {
            game.keysCollected--;
            elements.gameKeys.textContent = game.keysCollected;
            closeModal('keyModal');
            showNotification('使用了一把钥匙继续游戏', 'success');
        }

        // 开始多人在线游戏
        function startMultiplayerGame() {
            gameData.multiplayerActive = true;
            multiplayerGame.lastTime = Date.now();
            multiplayerGame.gameLoop = requestAnimationFrame(updateMultiplayerGame);
            
            // 显示游戏界面
            elements.multiplayerGameContainer.style.display = 'flex';
            elements.lobbyPlayers.style.display = 'none';
        }

        // 更新多人在线游戏
        function updateMultiplayerGame() {
            if (!gameData.multiplayerActive) return;
            
            const currentTime = Date.now();
            const deltaTime = (currentTime - multiplayerGame.lastTime) / 1000;
            multiplayerGame.lastTime = currentTime;
            
            // 更新游戏时间
            multiplayerGame.time += deltaTime;
            elements.mpTime.textContent = Math.floor(multiplayerGame.time);
            
            // 增加难度
            multiplayerGame.speed = gameData.gameSettings.baseSpeed + (multiplayerGame.time * gameData.gameSettings.speedIncrease);
            
            // 清除画布
            multiplayerGame.ctx.clearRect(0, 0, elements.mpGameCanvas.width, elements.mpGameCanvas.height);
            
            // 更新玩家和物品位置（模拟）
            // 在实际应用中，这里会从服务器获取实时数据
            
            // 继续游戏循环
            multiplayerGame.gameLoop = requestAnimationFrame(updateMultiplayerGame);
        }

        // 停止多人在线游戏
        function stopMultiplayerGame() {
            gameData.multiplayerActive = false;
            cancelAnimationFrame(multiplayerGame.gameLoop);
        }

        // 寻找比赛
        function findMatch() {
            showLoading('正在寻找对手...');
            
            // 模拟匹配过程
            setTimeout(() => {
                hideLoading();
                startMultiplayerGame();
            }, 2000);
        }

        // 加载商店物品
        function loadShopItems() {
            const user = gameData.currentUser;
            
            // 清空现有物品
            elements.skinsTab.innerHTML = '';
            elements.avatarsTab.innerHTML = '';
            elements.powerupsTab.innerHTML = '';
            elements.vipTab.innerHTML = '';
            elements.avatarSelection.innerHTML = '';
            
            // 加载皮肤
            gameData.shopItems.skins.forEach(skin => {
                const owned = user.items.skins.includes(skin.id);
                const equipped = user.equipped.skin === skin.id;
                
                const skinElement = createShopItem(skin, owned, equipped, 'skin');
                elements.skinsTab.appendChild(skinElement);
                
                // 添加到头像选择（如果是头像）
                if (skin.id <= 8) { // 假设前8个皮肤也可以用作头像
                    const avatarElement = createShopItem(skin, user.items.avatars.includes(skin.id), user.equipped.avatar === skin.id, 'avatar', true);
                    elements.avatarSelection.appendChild(avatarElement);
                }
            });
            
            // 加载头像
            gameData.shopItems.avatars.forEach(avatar => {
                const owned = user.items.avatars.includes(avatar.id);
                const equipped = user.equipped.avatar === avatar.id;
                
                const avatarElement = createShopItem(avatar, owned, equipped, 'avatar');
                elements.avatarsTab.appendChild(avatarElement);
                
                // 添加到头像选择
                const avatarSelectElement = createShopItem(avatar, owned, equipped, 'avatar', true);
                elements.avatarSelection.appendChild(avatarSelectElement);
            });
            
            // 加载道具
            gameData.shopItems.powerups.forEach(powerup => {
                const owned = user.items.powerups.includes(powerup.id);
                
                const powerupElement = createShopItem(powerup, owned, false, 'powerup');
                elements.powerupsTab.appendChild(powerupElement);
            });
            
            // 加载VIP
            gameData.shopItems.vip.forEach(vip => {
                const owned = user.isVIP && vip.id === 2; // 假设id 2是年卡
                
                const vipElement = createShopItem(vip, owned, false, 'vip');
                elements.vipTab.appendChild(vipElement);
            });
        }

        // 创建商店物品元素
        function createShopItem(item, owned, equipped, type, forSelection = false) {
            const itemElement = document.createElement('div');
            itemElement.className = 'shop-item';
            
            const img = document.createElement('img');
            img.src = item.image;
            img.alt = item.name;
            img.className = 'shop-item-image';
            
            const info = document.createElement('div');
            info.className = 'shop-item-info';
            
            const name = document.createElement('div');
            name.className = 'shop-item-name';
            name.textContent = item.name;
            
            const price = document.createElement('div');
            price.className = 'shop-item-price';
            
            if (type === 'vip') {
                price.innerHTML = `<i class="fas fa-coins" style="color: var(--warning-color)"></i> ${item.price}`;
            } else {
                price.innerHTML = `<i class="fas fa-coins" style="color: var(--warning-color)"></i> ${item.price}`;
            }
            
            info.appendChild(name);
            info.appendChild(price);
            
            itemElement.appendChild(img);
            itemElement.appendChild(info);
            
            if (owned) {
                const ownedBadge = document.createElement('div');
                ownedBadge.className = 'shop-item-owned';
                ownedBadge.textContent = '已拥有';
                itemElement.appendChild(ownedBadge);
                
                if (equipped && !forSelection) {
                    const equipBadge = document.createElement('div');
                    equipBadge.className = 'shop-item-equip';
                    equipBadge.textContent = '已装备';
                    itemElement.appendChild(equipBadge);
                }
            }
            
            if (!forSelection) {
                itemElement.addEventListener('click', () => handleShopItemClick(item, type, owned, equipped));
            } else {
                itemElement.addEventListener('click', () => selectAvatar(item));
            }
            
            return itemElement;
        }

        // 处理商店物品点击
        function handleShopItemClick(item, type, owned, equipped) {
            const user = gameData.currentUser;
            
            if (owned) {
                if (type === 'skin' || type === 'avatar') {
                    // 装备皮肤或头像
                    if (!equipped) {
                        user.equipped[type] = item.id;
                        updateUserUI();
                        showNotification(`${item.name} 已装备`, 'success');
                    }
                } else if (type === 'vip') {
                    // VIP已购买
                    showNotification('您已经是VIP会员', 'info');
                }
            } else {
                // 购买物品
                if (user.coins >= item.price) {
                    showConfirmModal(`确认购买 ${item.name}?`, `花费 ${item.price} 金币`, () => {
                        user.coins -= item.price;
                        
                        if (type === 'vip') {
                            user.isVIP = true;
                            showNotification('VIP会员已激活！', 'success');
                        } else {
                            user.items[type + 's'].push(item.id);
                            
                            if (type === 'powerup') {
                                showNotification(`${item.name} 已添加到您的道具库`, 'success');
                            } else {
                                showNotification(`${item.name} 购买成功`, 'success');
                            }
                        }
                        
                        updateUserUI();
                    });
                } else {
                    showNotification('金币不足', 'error');
                }
            }
        }

        // 切换商店标签
        function switchShopTab(tab) {
            // 更新活动标签
            document.querySelectorAll('.shop-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            // 显示对应的内容
            elements.skinsTab.style.display = tab === 'skins' ? 'grid' : 'none';
            elements.avatarsTab.style.display = tab === 'avatars' ? 'grid' : 'none';
            elements.powerupsTab.style.display = tab === 'powerups' ? 'grid' : 'none';
            elements.vipTab.style.display = tab === 'vip' ? 'grid' : 'none';
        }

        // 加载排行榜
        function loadLeaderboard() {
            elements.leaderboardList.innerHTML = '';
            
            // 按高分排序
            const sortedUsers = [...gameData.users].sort((a, b) => b.highscore - a.highscore);
            
            sortedUsers.forEach((user, index) => {
                const rank = index + 1;
                const item = document.createElement('div');
                item.className = 'leaderboard-item';
                
                item.innerHTML = `
                    <div class="leaderboard-rank">${rank}</div>
                    <img src="${user.avatar}" alt="${user.username}" class="leaderboard-avatar">
                    <div class="leaderboard-user">
                        <div class="leaderboard-username">
                            ${user.nickname || user.username}
                            ${user.isAdmin ? '<span class="leaderboard-badge leaderboard-admin">管理员</span>' : ''}
                            ${user.isVIP ? '<span class="leaderboard-badge leaderboard-vip">VIP</span>' : ''}
                        </div>
                    </div>
                    <div class="leaderboard-score">${user.highscore}</div>
                `;
                
                elements.leaderboardList.appendChild(item);
            });
        }

        // 切换排行榜标签
        function switchLeaderboardTab(tab) {
            // 更新活动标签
            document.querySelectorAll('.leaderboard-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            // 在实际应用中，这里会加载不同的排行榜数据
            // 现在只是重新加载全部排行榜
            loadLeaderboard();
        }

        // 加载管理员用户列表
        function loadAdminUsers() {
            elements.adminUsersList.innerHTML = '';
            
            gameData.users.forEach(user => {
                const item = document.createElement('div');
                item.className = 'admin-user-item';
                
                item.innerHTML = `
                    <img src="${user.avatar}" alt="${user.username}" class="admin-user-avatar">
                    <div class="admin-user-info">
                        <div class="admin-username">
                            ${user.nickname || user.username}
                            ${user.isAdmin ? '<span class="admin-user-badge admin-user-admin">管理员</span>' : ''}
                            ${user.isVIP ? '<span class="admin-user-badge admin-user-vip">VIP</span>' : ''}
                        </div>
                    </div>
                    <div class="admin-user-actions">
                        ${!user.isAdmin ? '<button class="admin-action-btn admin-promote-btn">设为管理员</button>' : ''}
                        <button class="admin-action-btn admin-ban-btn">封禁</button>
                        <button class="admin-action-btn admin-gift-btn">赠送</button>
                    </div>
                `;
                
                // 设置事件监听器
                const promoteBtn = item.querySelector('.admin-promote-btn');
                const banBtn = item.querySelector('.admin-ban-btn');
                const giftBtn = item.querySelector('.admin-gift-btn');
                
                if (promoteBtn) {
                    promoteBtn.addEventListener('click', () => promoteUser(user.id));
                }
                
                banBtn.addEventListener('click', () => banUser(user.id));
                giftBtn.addEventListener('click', () => giftUser(user.id));
                
                elements.adminUsersList.appendChild(item);
            });
        }

        // 切换管理员标签
        function switchAdminTab(tab) {
            // 更新活动标签
            document.querySelectorAll('.admin-tab').forEach(t => {
                t.classList.toggle('active', t.dataset.tab === tab);
            });
            
            // 在实际应用中，这里会加载不同的管理界面
        }

        // 搜索用户
        function searchUsers() {
            const query = elements.adminSearchInput.value.toLowerCase();
            
            if (!query) {
                loadAdminUsers();
                return;
            }
            
            const filteredUsers = gameData.users.filter(user => 
                user.username.toLowerCase().includes(query) || 
                (user.nickname && user.nickname.toLowerCase().includes(query))
                .sort((a, b) => b.highscore - a.highscore);
            
            elements.adminUsersList.innerHTML = '';
            
            filteredUsers.forEach(user => {
                const item = document.createElement('div');
                item.className = 'admin-user-item';
                
                item.innerHTML = `
                    <img src="${user.avatar}" alt="${user.username}" class="admin-user-avatar">
                    <div class="admin-user-info">
                        <div class="admin-username">
                            ${user.nickname || user.username}
                            ${user.isAdmin ? '<span class="admin-user-badge admin-user-admin">管理员</span>' : ''}
                            ${user.isVIP ? '<span class="admin-user-badge admin-user-vip">VIP</span>' : ''}
                        </div>
                    </div>
                    <div class="admin-user-actions">
                        ${!user.isAdmin ? '<button class="admin-action-btn admin-promote-btn">设为管理员</button>' : ''}
                        <button class="admin-action-btn admin-ban-btn">封禁</button>
                        <button class="admin-action-btn admin-gift-btn">赠送</button>
                    </div>
                `;
                
                // 设置事件监听器
                const promoteBtn = item.querySelector('.admin-promote-btn');
                const banBtn = item.querySelector('.admin-ban-btn');
                const giftBtn = item.querySelector('.admin-gift-btn');
                
                if (promoteBtn) {
                    promoteBtn.addEventListener('click', () => promoteUser(user.id));
                }
                
                banBtn.addEventListener('click', () => banUser(user.id));
                giftBtn.addEventListener('click', () => giftUser(user.id));
                
                elements.adminUsersList.appendChild(item);
            });
        }

        // 提升用户为管理员
        function promoteUser(userId) {
            const user = gameData.users.find(u => u.id === userId);
            
            if (user) {
                showConfirmModal('设为管理员', `确定要将 ${user.nickname || user.username} 设为管理员吗？`, () => {
                    user.isAdmin = true;
                    loadAdminUsers();
                    showNotification(`${user.nickname || user.username} 已成为管理员`, 'success');
                });
            }
        }

        // 封禁用户
        function banUser(userId) {
            const user = gameData.users.find(u => u.id === userId);
            
            if (user) {
                showConfirmModal('封禁用户', `确定要封禁 ${user.nickname || user.username} 吗？`, () => {
                    // 在实际应用中，这里会将用户标记为封禁
                    showNotification(`${user.nickname || user.username} 已被封禁`, 'success');
                });
            }
        }

        // 赠送物品给用户
        function giftUser(userId) {
            const user = gameData.users.find(u => u.id === userId);
            gameData.adminSelectedUser = user;
            
            if (user) {
                elements.adminActionTitle.textContent = `赠送物品给 ${user.nickname || user.username}`;
                elements.adminActionBody.innerHTML = `
                    <div class="form-group">
                        <label>选择物品类型</label>
                        <select id="giftType" class="form-control">
                            <option value="coins">金币</option>
                            <option value="keys">钥匙</option>
                            <option value="skin">皮肤</option>
                            <option value="avatar">头像</option>
                            <option value="vip">VIP会员</option>
                        </select>
                    </div>
                    <div class="form-group" id="giftAmountGroup">
                        <label>数量</label>
                        <input type="number" id="giftAmount" class="form-control" value="100" min="1">
                    </div>
                    <div class="form-group" id="giftItemGroup" style="display: none;">
                        <label>选择物品</label>
                        <select id="giftItem" class="form-control">
                            ${gameData.shopItems.skins.map(skin => `<option value="skin_${skin.id}">${skin.name}</option>`).join('')}
                            ${gameData.shopItems.avatars.map(avatar => `<option value="avatar_${avatar.id}">${avatar.name}</option>`).join('')}
                        </select>
                    </div>
                `;
                
                const giftType = document.getElementById('giftType');
                const giftAmountGroup = document.getElementById('giftAmountGroup');
                const giftItemGroup = document.getElementById('giftItemGroup');
                
                giftType.addEventListener('change', () => {
                    if (giftType.value === 'coins' || giftType.value === 'keys') {
                        giftAmountGroup.style.display = 'block';
                        giftItemGroup.style.display = 'none';
                    } else {
                        giftAmountGroup.style.display = 'none';
                        giftItemGroup.style.display = 'block';
                    }
                });
                
                showModal('adminActionModal');
                
                elements.confirmAdminActionBtn.onclick = () => {
                    const type = giftType.value;
                    
                    if (type === 'coins') {
                        const amount = parseInt(document.getElementById('giftAmount').value);
                        user.coins += amount;
                        showNotification(`已赠送 ${amount} 金币给 ${user.nickname || user.username}`, 'success');
                    } else if (type === 'keys') {
                        const amount = parseInt(document.getElementById('giftAmount').value);
                        user.keys += amount;
                        showNotification(`已赠送 ${amount} 把钥匙给 ${user.nickname || user.username}`, 'success');
                    } else if (type === 'skin') {
                        const itemId = parseInt(document.getElementById('giftItem').value.split('_')[1]);
                        if (!user.items.skins.includes(itemId)) {
                            user.items.skins.push(itemId);
                            showNotification(`已赠送皮肤给 ${user.nickname || user.username}`, 'success');
                        } else {
                            showNotification('用户已拥有该皮肤', 'info');
                        }
                    } else if (type === 'avatar') {
                        const itemId = parseInt(document.getElementById('giftItem').value.split('_')[1]);
                        if (!user.items.avatars.includes(itemId)) {
                            user.items.avatars.push(itemId);
                            showNotification(`已赠送头像给 ${user.nickname || user.username}`, 'success');
                        } else {
                            showNotification('用户已拥有该头像', 'info');
                        }
                    } else if (type === 'vip') {
                        user.isVIP = true;
                        showNotification(`已赠送VIP会员给 ${user.nickname || user.username}`, 'success');
                    }
                    
                    closeModal('adminActionModal');
                };
            }
        }

        // 更新开发者统计
        function updateDeveloperStats() {
            elements.totalUsers.textContent = gameData.users.length;
            elements.activeUsers.textContent = gameData.users.filter(u => new Date() - new Date(u.lastLogin) < 86400000).length;
            elements.totalGames.textContent = gameData.users.reduce((sum, user) => sum + user.gamesPlayed, 0);
        }

        // 更新网站
        function updateWebsite() {
            const code = elements.codeEditor.value;
            
            if (!code) {
                showNotification('请输入更新代码', 'error');
                return;
            }
            
            showConfirmModal('更新网站', '确定要更新网站代码吗？此操作不可逆！', () => {
                showNotification('网站更新成功', 'success');
                // 在实际应用中，这里会将代码保存到服务器
            });
        }

        // 恢复账户
        function recoverAccount() {
            elements.adminActionTitle.textContent = '恢复账户';
            elements.adminActionBody.innerHTML = `
                <div class="form-group">
                    <label>用户名</label>
                    <input type="text" id="recoverUsername" class="form-control" placeholder="输入要恢复的用户名">
                </div>
            `;
            
            showModal('adminActionModal');
            
            elements.confirmAdminActionBtn.onclick = () => {
                const username = document.getElementById('recoverUsername').value.trim();
                
                if (!username) {
                    showNotification('请输入用户名', 'error');
                    return;
                }
                
                // 在实际应用中，这里会从服务器恢复账户
                // 现在只是模拟
                showNotification(`账户 ${username} 已恢复，密码已重置为 19996837879gxhbsh`, 'success');
                closeModal('adminActionModal');
            };
        }

        // 重置密码
        function resetPassword() {
            elements.adminActionTitle.textContent = '重置密码';
            elements.adminActionBody.innerHTML = `
                <div class="form-group">
                    <label>用户名</label>
                    <input type="text" id="resetUsername" class="form-control" placeholder="输入要重置密码的用户名">
                </div>
            `;
            
            showModal('adminActionModal');
            
            elements.confirmAdminActionBtn.onclick = () => {
                const username = document.getElementById('resetUsername').value.trim();
                
                if (!username) {
                    showNotification('请输入用户名', 'error');
                    return;
                }
                
                // 在实际应用中，这里会重置密码
                // 现在只是模拟
                showNotification(`用户 ${username} 的密码已重置为 19996837879gxhbsh`, 'success');
                closeModal('adminActionModal');
            };
        }

        // 删除用户
        function deleteUser() {
            elements.adminActionTitle.textContent = '删除用户';
            elements.adminActionBody.innerHTML = `
                <div class="form-group">
                    <label>用户名</label>
                    <input type="text" id="deleteUsername" class="form-control" placeholder="输入要删除的用户名">
                </div>
            `;
            
            showModal('adminActionModal');
            
            elements.confirmAdminActionBtn.onclick = () => {
                const username = document.getElementById('deleteUsername').value.trim();
                
                if (!username) {
                    showNotification('请输入用户名', 'error');
                    return;
                }
                
                if (username === gameData.currentUser.username) {
                    showNotification('不能删除当前登录的用户', 'error');
                    return;
                }
                
                showConfirmModal('确认删除', `确定要永久删除用户 ${username} 吗？此操作不可逆！`, () => {
                    // 在实际应用中，这里会删除用户
                    // 现在只是模拟
                    showNotification(`用户 ${username} 已被删除`, 'success');
                    closeModal('adminActionModal');
                });
            };
        }

        // 备份数据
        function backupData() {
            showLoading('正在备份数据...');
            
            setTimeout(() => {
                hideLoading();
                showNotification('数据备份成功', 'success');
            }, 1500);
        }

        // 清除缓存
        function clearCache() {
            showConfirmModal('清除缓存', '确定要清除所有缓存数据吗？', () => {
                showNotification('缓存已清除', 'success');
            });
        }

        // 重置系统
        function resetSystem() {
            showConfirmModal('重置系统', '确定要重置整个系统吗？所有数据将被清除！', () => {
                showNotification('系统已重置', 'success');
            });
        }

        // 保存个人资料
        function saveProfile(e) {
            e.preventDefault();
            
            const nickname = elements.profileNickname.value.trim();
            const status = elements.profileStatus.value.trim();
            
            gameData.currentUser.nickname = nickname || null;
            gameData.currentUser.status = status || null;
            
            updateUserUI();
            showNotification('个人资料已保存', 'success');
        }

        // 切换账号
        function switchAccount() {
            showConfirmModal('切换账号', '确定要切换到其他账号吗？', () => {
                logout();
                elements.authContainer.style.display = 'flex';
                elements.mainContainer.style.display = 'none';
            });
        }

        // 退出登录
        function logout() {
            gameData.currentUser = null;
            gameData.isLoggedIn = false;
            
            localStorage.removeItem('username');
            localStorage.removeItem('password');
            localStorage.removeItem('rememberMe');
            
            elements.authContainer.style.display = 'flex';
            elements.mainContainer.style.display = 'none';
            
            // 重置表单
            elements.authForm.reset();
            elements.authTitle.textContent = '登录';
            elements.authBtn.textContent = '登录';
            elements.switchLink.textContent = '还没有账号？立即注册';
            elements.rememberMeContainer.style.display = 'flex';
        }

        // 打开头像模态框
        function openAvatarModal() {
            showModal('avatarModal');
        }

        // 关闭头像模态框
        function closeAvatarModal() {
            closeModal('avatarModal');
        }

        // 选择头像
        function selectAvatar(item) {
            const user = gameData.currentUser;
            
            if (user.items.avatars.includes(item.id) {
                user.equipped.avatar = item.id;
                user.avatar = item.image;
                updateUserUI();
                closeModal('avatarModal');
                showNotification('头像已更改', 'success');
            } else {
                showNotification('您尚未购买此头像', 'error');
            }
        }

        // 保存头像
        function saveAvatar() {
            // 已在selectAvatar中处理
            closeModal('avatarModal');
        }

        // 显示设置
        function showSettings() {
            showNotification('设置功能开发中', 'info');
        }

        // 显示帮助
        function showHelp() {
            showNotification('帮助文档开发中', 'info');
        }

        // 加入QQ群
        function joinQQGroup() {
            window.open('https://qm.qq.com/q/kTAmEkJ8Na', '_blank');
        }

        // 联系开发者
        function contactDeveloper() {
            window.open('mailto:3530388417@qq.com', '_blank');
        }

        // 处理键盘按下
        function handleKeyDown(e) {
            if (!gameData.gameActive && !gameData.multiplayerActive) return;
            
            switch (e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    game.keys.up = true;
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    game.keys.down = true;
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    game.keys.left = true;
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    game.keys.right = true;
                    break;
                case ' ':
                    if (gameData.gameActive) useKey();
                    break;
            }
        }

        // 处理键盘释放
        function handleKeyUp(e) {
            switch (e.key) {
                case 'ArrowUp':
                case 'w':
                case 'W':
                    game.keys.up = false;
                    break;
                case 'ArrowDown':
                case 's':
                case 'S':
                    game.keys.down = false;
                    break;
                case 'ArrowLeft':
                case 'a':
                case 'A':
                    game.keys.left = false;
                    break;
                case 'ArrowRight':
                case 'd':
                case 'D':
                    game.keys.right = false;
                    break;
            }
        }

        // 显示模态框
        function showModal(modalId) {
            elements[modalId].style.display = 'flex';
        }

        // 关闭模态框
        function closeModal(modalId) {
            elements[modalId].style.display = 'none';
        }

        // 显示确认模态框
        function showConfirmModal(title, message, callback) {
            elements.confirmTitle.textContent = title;
            elements.confirmMessage.textContent = message;
            
            // 设置确认按钮回调
            elements.confirmBtn.onclick = () => {
                callback();
                closeModal('confirmModal');
            };
            
            showModal('confirmModal');
        }

        // 显示通知
        function showNotification(message, type = 'success') {
            elements.notification.className = `notification ${type}`;
            elements.notificationMessage.textContent = message;
            elements.notification.classList.add('show');
            
            setTimeout(() => {
                elements.notification.classList.remove('show');
            }, 3000);
        }

        // 显示加载中
        function showLoading(text = '加载中...') {
            elements.loadingText.textContent = text;
            elements.loadingContainer.style.display = 'flex';
        }

        // 隐藏加载中
        function hideLoading() {
            elements.loadingContainer.style.display = 'none';
        }

        // 模拟在线玩家
        function simulateOnlinePlayers() {
            // 随机在线玩家数量
            const onlineCount = Math.floor(Math.random() * 50) + 10;
            elements.onlineCount.textContent = onlineCount;
            
            // 更新在线玩家列表
            elements.lobbyPlayers.innerHTML = '';
            
            for (let i = 0; i < Math.min(6, onlineCount); i++) {
                const randomUser = gameData.users[Math.floor(Math.random() * gameData.users.length)];
                const isReady = Math.random() > 0.5;
                
                const player = document.createElement('div');
                player.className = 'lobby-player';
                
                player.innerHTML = `
                    <img src="${randomUser.avatar}" alt="${randomUser.username}" class="lobby-avatar">
                    <div class="lobby-username">${randomUser.nickname || randomUser.username}</div>
                    ${isReady ? '<div class="lobby-ready">准备就绪</div>' : '<div class="lobby-waiting">等待中</div>'}
                `;
                
                elements.lobbyPlayers.appendChild(player);
            }
            
            // 每10秒更新一次
            setTimeout(simulateOnlinePlayers, 10000);
        }

        // 初始化应用
        init();
    </script>
</body>
</html>
